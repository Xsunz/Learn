# å­¦ä¹ ç›®æ ‡

- äº†è§£SPUå’ŒSKUçš„æ¦‚å¿µ
- äº†è§£SPUå’ŒSKUè¡¨ç»“æ„çš„å…³é”®å­—æ®µ
- ç‹¬ç«‹å®ç°å•†å“æŸ¥è¯¢
- ç‹¬ç«‹å®ç°å•†å“æ–°å¢ã€ä¿®æ”¹
- å®Œæˆå‰å°ç³»ç»Ÿçš„æ­å»º

# 1.SPUå’ŒSKU

## é‡ç‚¹ï¼šäº†è§£SPUå’ŒSKUçš„æ¦‚å¿µå’Œè¡¨ç»“æ„

## 1.1.ä»€ä¹ˆæ˜¯SPUå’ŒSKU

SPUï¼šStandard Product Unit ï¼ˆæ ‡å‡†äº§å“å•ä½ï¼‰ ï¼Œä¸€ç»„å…·æœ‰å…±åŒå±æ€§çš„å•†å“é›†

SKUï¼šStock Keeping Unitï¼ˆåº“å­˜é‡å•ä½ï¼‰ï¼ŒSPUå•†å“é›†å› å…·ä½“ç‰¹æ€§ä¸åŒè€Œç»†åˆ†çš„æ¯ä¸ªå•†å“

ä»¥å›¾ä¸ºä¾‹æ¥çœ‹ï¼š

![1526085541996](assets/1526085541996.png)

- æœ¬é¡µçš„ åä¸ºMate10 å°±æ˜¯ä¸€ä¸ªå•†å“é›†ï¼ˆSPUï¼‰
- å› ä¸ºé¢œè‰²ã€å†…å­˜ç­‰ä¸åŒï¼Œè€Œç»†åˆ†å‡ºä¸åŒçš„Mate10ï¼Œå¦‚äº®é»‘è‰²128Gç‰ˆã€‚ï¼ˆSKUï¼‰

å¯ä»¥çœ‹å‡ºï¼š

- SPUæ˜¯ä¸€ä¸ªæŠ½è±¡çš„å•†å“é›†æ¦‚å¿µï¼Œä¸ºäº†æ–¹ä¾¿åå°çš„ç®¡ç†ã€‚
- SKUæ‰æ˜¯å…·ä½“è¦é”€å”®çš„å•†å“ï¼Œæ¯ä¸€ä¸ªSKUçš„ä»·æ ¼ã€åº“å­˜å¯èƒ½ä¼šä¸ä¸€æ ·ï¼Œç”¨æˆ·è´­ä¹°çš„æ˜¯SKUè€Œä¸æ˜¯SPU



## 1.2.æ•°æ®åº“è®¾è®¡åˆ†æ

### 1.2.1.æ€è€ƒåˆ†æ

å¼„æ¸…æ¥šäº†SPUå’ŒSKUçš„æ¦‚å¿µåŒºåˆ†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·æ€è€ƒä¸€ä¸‹è¯¥å¦‚ä½•è®¾è®¡æ•°æ®åº“è¡¨ã€‚

é¦–å…ˆæ¥çœ‹SPUï¼Œå¤§å®¶ä¸€èµ·æ€è€ƒä¸‹SPUåº”è¯¥æœ‰å“ªäº›å­—æ®µæ¥æè¿°ï¼Ÿ

```
id:ä¸»é”®
titleï¼šæ ‡é¢˜
descriptionï¼šæè¿°
specificationï¼šè§„æ ¼
packaging_listï¼šåŒ…è£…
after_serviceï¼šå”®åæœåŠ¡
commentï¼šè¯„ä»·
category_idï¼šå•†å“åˆ†ç±»
brand_idï¼šå“ç‰Œ
```

ä¼¼ä¹å¹¶ä¸å¤æ‚.

å†çœ‹ä¸‹SKUï¼Œå¤§å®¶è§‰å¾—åº”è¯¥æœ‰ä»€ä¹ˆå­—æ®µï¼Ÿ

```
idï¼šä¸»é”®
spu_idï¼šå…³è”çš„spu
priceï¼šä»·æ ¼
imagesï¼šå›¾ç‰‡
stockï¼šåº“å­˜
é¢œè‰²ï¼Ÿ
å†…å­˜ï¼Ÿ
ç¡¬ç›˜ï¼Ÿ
```

skuçš„ç‰¹æœ‰å±æ€§ä¹Ÿæ˜¯å˜åŒ–çš„ï¼Œä¸åŒå•†å“ï¼Œç‰¹æœ‰å±æ€§ä¸ä¸€å®šç›¸åŒï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„è¡¨å­—æ®µå²‚ä¸æ˜¯ä¸ç¡®å®šï¼Ÿ

skuçš„è¿™ä¸ªç‰¹æœ‰å±æ€§è¯¥å¦‚ä½•è®¾è®¡å‘¢ï¼Ÿ



### 1.2.2.SKUçš„ç‰¹æœ‰å±æ€§

SPUä¸­ä¼šæœ‰ä¸€äº›ç‰¹æ®Šå±æ€§ï¼Œç”¨æ¥åŒºåˆ†ä¸åŒçš„SKUï¼Œæˆ‘ä»¬ç§°ä¸ºSKUç‰¹æœ‰å±æ€§ã€‚å¦‚åä¸ºMETA10çš„é¢œè‰²ã€å†…å­˜å±æ€§ã€‚

ä¸åŒç§ç±»çš„å•†å“ï¼Œä¸€ä¸ªæ‰‹æœºï¼Œä¸€ä¸ªè¡£æœï¼Œå…¶SKUå±æ€§ä¸ç›¸åŒã€‚

åŒä¸€ç§ç±»çš„å•†å“ï¼Œæ¯”å¦‚éƒ½æ˜¯è¡£æœï¼ŒSKUå±æ€§åŸºæœ¬æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯é¢œè‰²ã€å°ºç ç­‰ã€‚

è¿™æ ·è¯´èµ·æ¥ï¼Œä¼¼ä¹SKUçš„ç‰¹æœ‰å±æ€§ä¹Ÿæ˜¯ä¸åˆ†ç±»ç›¸å…³çš„ï¼Ÿäº‹å®ä¸Šï¼Œä»”ç»†è§‚å¯Ÿä½ ä¼šå‘ç°ï¼Œ**SKUçš„ç‰¹æœ‰å±æ€§æ˜¯å•†å“è§„æ ¼å‚æ•°çš„ä¸€éƒ¨åˆ†**ï¼š

![1526088981953](assets/1526088981953.png)



ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æ²¡å¿…è¦å•ç‹¬å¯¹SKUçš„ç‰¹æœ‰å±æ€§è¿›è¡Œè®¾è®¡ï¼Œå®ƒå¯ä»¥çœ‹åšæ˜¯è§„æ ¼å‚æ•°ä¸­çš„ä¸€éƒ¨åˆ†ã€‚è¿™æ ·è§„æ ¼å‚æ•°ä¸­çš„å±æ€§å¯ä»¥æ ‡è®°æˆä¸¤éƒ¨åˆ†ï¼š

- spuä¸‹æ‰€æœ‰skuå…±äº«çš„è§„æ ¼å±æ€§ï¼ˆç§°ä¸ºé€šç”¨å±æ€§ï¼‰
- spuä¸‹æ¯ä¸ªskuä¸åŒçš„è§„æ ¼å±æ€§ï¼ˆç§°ä¸ºç‰¹æœ‰å±æ€§ï¼‰

å›ä¸€ä¸‹ä¹‹å‰æˆ‘ä»¬è®¾è®¡çš„tb_spec_paramè¡¨ï¼Œæ˜¯ä¸æ˜¯æœ‰ä¸€ä¸ªå­—æ®µï¼Œåä¸ºgenericï¼Œæ ‡è®°é€šç”¨å’Œç‰¹æœ‰å±æ€§ã€‚å°±æ˜¯ä¸ºäº†è¿™é‡Œä½¿ç”¨ã€‚

è¿™æ ·ä»¥æ¥ï¼Œå•†å“SKUè¡¨å°±åªéœ€è¦è®¾è®¡è§„æ ¼å±æ€§ä»¥å¤–çš„å…¶å®ƒå­—æ®µäº†ï¼Œè§„æ ¼å±æ€§ç”±ä¹‹å‰çš„è§„æ ¼å‚æ•°è¡¨`tb_spec_param`æ¥ä¿å­˜ã€‚



ä½†æ˜¯ï¼Œè§„æ ¼å±æ€§çš„å€¼ä¾ç„¶æ˜¯éœ€è¦ä¸å•†å“ç›¸å…³è”çš„ã€‚

## 1.3.SPUè¡¨

### 1.3.1.è¡¨ç»“æ„

SPUè¡¨ï¼š

```mysql
CREATE TABLE `tb_spu` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'spu id',
  `name` varchar(256) NOT NULL DEFAULT '' COMMENT 'å•†å“åç§°',
  `sub_title` varchar(256) DEFAULT '' COMMENT 'å‰¯æ ‡é¢˜ï¼Œä¸€èˆ¬æ˜¯ä¿ƒé”€ä¿¡æ¯',
  `cid1` bigint(20) NOT NULL COMMENT '1çº§ç±»ç›®id',
  `cid2` bigint(20) NOT NULL COMMENT '2çº§ç±»ç›®id',
  `cid3` bigint(20) NOT NULL COMMENT '3çº§ç±»ç›®id',
  `brand_id` bigint(20) NOT NULL COMMENT 'å•†å“æ‰€å±å“ç‰Œid',
  `saleable` tinyint(1) NOT NULL DEFAULT '1' COMMENT 'æ˜¯å¦ä¸Šæ¶ï¼Œ0ä¸‹æ¶ï¼Œ1ä¸Šæ¶',
  `create_time` timestamp NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'æ·»åŠ æ—¶é—´',
  `update_time` timestamp NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'æœ€åä¿®æ”¹æ—¶é—´',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8 COMMENT='spuè¡¨ï¼Œè¯¥è¡¨æè¿°çš„æ˜¯ä¸€ä¸ªæŠ½è±¡æ€§çš„å•†å“ï¼Œæ¯”å¦‚ iphone8';
```

ä¸æˆ‘ä»¬å‰é¢åˆ†æçš„åŸºæœ¬ç±»ä¼¼ï¼Œä½†æ˜¯ä¼¼ä¹å°‘äº†ä¸€äº›å­—æ®µï¼Œæ¯”å¦‚å•†å“æè¿°ã€‚

æˆ‘ä»¬åšäº†è¡¨çš„å‚ç›´æ‹†åˆ†ï¼Œå°†SPUçš„è¯¦æƒ…æ”¾åˆ°äº†å¦ä¸€å¼ è¡¨ï¼štb_spu_detail

```mysql
CREATE TABLE `tb_spu_detail` (
  `spu_id` bigint(20) NOT NULL,
  `description` text COMMENT 'å•†å“æè¿°ä¿¡æ¯',
  `generic_spec` varchar(2048) NOT NULL DEFAULT '' COMMENT 'é€šç”¨è§„æ ¼å‚æ•°æ•°æ®ï¼Œjsonæ ¼å¼',
  `special_spec` varchar(1024) NOT NULL COMMENT 'ç‰¹æœ‰è§„æ ¼å‚æ•°åŠå¯é€‰å€¼ä¿¡æ¯ï¼Œjsonæ ¼å¼',
  `packing_list` varchar(1024) DEFAULT '' COMMENT 'åŒ…è£…æ¸…å•',
  `after_service` varchar(1024) DEFAULT '' COMMENT 'å”®åæœåŠ¡',
  `create_time` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `update_time` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`spu_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
```

è¿™å¼ è¡¨ä¸­çš„æ•°æ®éƒ½æ¯”è¾ƒå¤§ï¼Œä¸ºäº†ä¸å½±å“ä¸»è¡¨çš„æŸ¥è¯¢æ•ˆç‡æˆ‘ä»¬æ‹†åˆ†å‡ºè¿™å¼ è¡¨ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸¤ä¸ªå­—æ®µï¼šgeneric_specå’Œspecial_specã€‚

### 1.3.2.spuä¸­çš„è§„æ ¼å‚æ•°

å‰é¢è®²è¿‡è§„æ ¼å‚æ•°ä¸å•†å“åˆ†ç±»ç»‘å®šï¼ŒåŒä¸€åˆ†ç±»çš„å•†å“ï¼Œä¼šæœ‰ä¸€å¥—ç›¸åŒçš„è§„æ ¼å‚æ•°keyï¼ˆè§„æ ¼å‚æ•°æ¨¡æ¿ï¼‰ï¼Œä½†æ˜¯è¿™ä¸ªåˆ†ç±»ä¸‹æ¯ä¸ªå•†å“çš„è§„æ ¼å‚æ•°å€¼éƒ½ä¸ç›¸åŒï¼Œå› æ­¤è¦æ»¡è¶³ä¸‹é¢å‡ ç‚¹ï¼š

- æˆ‘ä»¬æœ‰ä¸€ä¸ªè§„æ ¼å‚æ•°è¡¨ï¼Œè·Ÿåˆ†ç±»å…³è”ï¼Œä¿å­˜çš„å°±æ˜¯æŸåˆ†ç±»ä¸‹çš„è§„æ ¼å‚æ•°æ¨¡æ¿ã€‚

- æˆ‘ä»¬è¿˜éœ€è¦è¡¨ï¼Œè·Ÿå•†å“å…³è”ï¼Œä¿å­˜æŸä¸ªå•†å“ï¼Œç›¸å…³è”çš„è§„æ ¼å‚æ•°çš„å€¼ã€‚
- è§„æ ¼å‚æ•°å› ä¸ºåˆ†æˆäº†é€šç”¨è§„æ ¼å‚æ•°å’Œç‰¹æœ‰è§„æ ¼å‚æ•°ï¼Œå› æ­¤è§„æ ¼å‚æ•°å€¼ä¹Ÿéœ€è¦åˆ†åˆ«äºSPUå’ŒSKUå…³è”ï¼š
  - é€šç”¨çš„è§„æ ¼å‚æ•°å€¼ä¸SPUå…³è”ã€‚
  - ç‰¹æœ‰è§„æ ¼å‚æ•°å€¼ä¸SKUå…³è”ã€‚

ä½†æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰å¢åŠ æ–°çš„è¡¨ï¼Œæ¥çœ‹ä¸‹æˆ‘ä»¬çš„ è¡¨å¦‚ä½•å­˜å‚¨è¿™äº›ä¿¡æ¯ï¼š

#### 1.3.2.1.generic_specå­—æ®µ

å¦‚æœè¦è®¾è®¡ä¸€å¼ è¡¨ï¼Œæ¥è¡¨ç¤ºspuä¸­çš„é€šç”¨è§„æ ¼å±æ€§çš„å€¼ï¼Œè‡³å°‘éœ€è¦ä¸‹é¢çš„å­—æ®µï¼š

```
spu_idï¼šä¸å“ªä¸ªå•†å“å…³è”
param_idï¼šæ˜¯å•†å“çš„å“ªä¸ªè§„æ ¼å‚æ•°
valueï¼šå…·ä½“çš„å€¼
```

æˆ‘ä»¬å¹¶æ²¡æœ‰è¿™ä¹ˆè®¾è®¡ã€‚è€Œæ˜¯æŠŠä¸æŸä¸ªå•†å“ç›¸å…³çš„è§„æ ¼å±æ€§å€¼ï¼Œç›´æ¥ä¿å­˜åˆ°è¿™ä¸ªå•†å“spuè¡¨ä¸­ï¼Œå› æ­¤è¿™äº›è§„æ ¼å±æ€§å…³è”çš„å•†å“å°±ä¸€ç›®äº†ç„¶ï¼Œé‚£ä¹ˆä¸Šè¿°3ä¸ªå±æ€§ä¸­çš„`spu_id`å°±æ— éœ€ä¿å­˜äº†ï¼Œè€Œå‰©ä¸‹çš„å°±æ˜¯`param_id`å’Œè§„æ ¼å‚æ•°å€¼äº†ã€‚ä¸¤è€…åˆšå¥½æ˜¯ä¸€ä¸€å¯¹åº”å…³ç³»ï¼Œç»„æˆä¸€ä¸ªé”®å€¼å¯¹ã€‚æˆ‘ä»¬åˆšå¥½å¯ä»¥ç”¨ä¸€ä¸ªjsonç»“æ„æ¥æ ‡ç¤ºã€‚

æ˜¯ä¹Ÿå°±æ˜¯spuDetailè¡¨ä¸­çš„`generic_spec`ï¼Œå…¶ä¸­ä¿å­˜é€šç”¨è§„æ ¼å‚æ•°ä¿¡æ¯çš„å€¼ï¼š

> æ•´ä½“æ¥çœ‹ï¼š

 ![1529554390912](assets/1529554390912.png)

jsonç»“æ„ï¼Œå…¶ä¸­éƒ½æ˜¯é”®å€¼å¯¹ï¼š

- keyï¼šå¯¹åº”çš„è§„æ ¼å‚æ•°çš„`spec_param`çš„id
- valueï¼šå¯¹åº”è§„æ ¼å‚æ•°çš„å€¼



#### 1.3.2.2.special_specå­—æ®µ

æˆ‘ä»¬è¯´spuä¸­åªä¿å­˜é€šç”¨è§„æ ¼å‚æ•°ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆæœ‰å¤šå‡ºäº†ä¸€ä¸ª`special_spec`å­—æ®µå‘¢ï¼Ÿ



ä»¥æ‰‹æœºä¸ºä¾‹ï¼Œå“ç‰Œã€æ“ä½œç³»ç»Ÿç­‰è‚¯å®šæ˜¯é€šç”¨è§„æ ¼å±æ€§ï¼Œå†…å­˜ã€é¢œè‰²ç­‰è‚¯å®šæ˜¯ç‰¹æœ‰å±æ€§ã€‚

å½“ä½ ç¡®å®šäº†ä¸€ä¸ªSPUï¼Œæ¯”å¦‚å°ç±³çš„ï¼šçº¢ç±³4Xï¼Œå› ä¸ºé¢œè‰²å†…å­˜ç­‰ä¸åŒï¼Œä¼šå½¢æˆå¤šä¸ªskuã€‚å¦‚æœæŠŠæ¯ä¸ªskuçš„é¢œè‰²ã€å†…å­˜ç­‰ä¿¡æ¯éƒ½æ•´ç†ä¸€ä¸‹ï¼Œä¼šå½¢æˆä¸‹é¢çš„ç»“æœï¼š

```
é¢œè‰²ï¼š[é¦™æ§Ÿé‡‘, æ¨±èŠ±ç²‰, ç£¨ç ‚é»‘]
å†…å­˜ï¼š[2G, 3G]
æœºèº«å­˜å‚¨ï¼š[16GB, 32GB]
```

ä¹Ÿå°±æ˜¯è¯´è¿™é‡ŒæŠŠä¸€ä¸ªspuä¸‹çš„æ¯ä¸ªskuçš„ç‰¹æœ‰è§„æ ¼å±æ€§å€¼èšåˆåœ¨äº†ä¸€èµ·ï¼è¿™ä¸ªå°±æ˜¯special_specå­—æ®µäº†ã€‚

æ¥çœ‹æ•°æ®æ ¼å¼ï¼š

 ![1529554916252](assets/1529554916252.png)

ä¹Ÿæ˜¯jsonç»“æ„ï¼š

- keyï¼šè§„æ ¼å‚æ•°id
- valueï¼šspuå±æ€§çš„æ•°ç»„



é‚£ä¹ˆé—®é¢˜æ¥ï¼šä¸ºä»€ä¹ˆè¦åœ¨spuä¸­æŠŠæ‰€æœ‰skuçš„è§„æ ¼å±æ€§èšåˆèµ·æ¥ä¿å­˜å‘¢ï¼Ÿ



å› ä¸ºæˆ‘ä»¬æœ‰æ—¶å€™éœ€è¦æŠŠæ‰€æœ‰è§„æ ¼å‚æ•°éƒ½æŸ¥è¯¢å‡ºæ¥ï¼Œè€Œä¸æ˜¯åªæŸ¥è¯¢1ä¸ªskuçš„å±æ€§ã€‚æ¯”å¦‚ï¼Œå•†å“è¯¦æƒ…é¡µå±•ç¤ºå¯é€‰çš„è§„æ ¼å‚æ•°æ—¶ï¼š

   ![1526267828817](assets/1526267828817.png)

åˆšå¥½ç¬¦åˆæˆ‘ä»¬çš„ç»“æ„ï¼Œè¿™æ ·é¡µé¢æ¸²æŸ“å°±éå¸¸æ–¹ä¾¿äº†ã€‚



ç»¼ä¸Šæ‰€è¿°ï¼Œspuä¸å•†å“è§„æ ¼å‚æ•°æ¨¡æ¿çš„å…³ç³»å¦‚å›¾æ‰€ç¤ºï¼š

![1552792606155](assets/1552792606155.png)

## 1.4.SKUè¡¨

### 1.4.1.è¡¨ç»“æ„

```mysql
CREATE TABLE `tb_sku` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'sku id',
  `spu_id` bigint(20) NOT NULL COMMENT 'spu id',
  `title` varchar(256) NOT NULL COMMENT 'å•†å“æ ‡é¢˜',
  `images` varchar(1024) DEFAULT '' COMMENT 'å•†å“çš„å›¾ç‰‡ï¼Œå¤šä¸ªå›¾ç‰‡ä»¥â€˜,â€™åˆ†å‰²',
  `stock` int(8) DEFAULT '9999' COMMENT 'åº“å­˜',
  `price` bigint(16) NOT NULL DEFAULT '0' COMMENT 'é”€å”®ä»·æ ¼ï¼Œå•ä½ä¸ºåˆ†',
  `indexes` varchar(32) DEFAULT '' COMMENT 'ç‰¹æœ‰è§„æ ¼å±æ€§åœ¨spuå±æ€§æ¨¡æ¿ä¸­çš„å¯¹åº”ä¸‹æ ‡ç»„åˆ',
  `own_spec` varchar(1024) DEFAULT '' COMMENT 'skuçš„ç‰¹æœ‰è§„æ ¼å‚æ•°é”®å€¼å¯¹ï¼Œjsonæ ¼å¼ï¼Œååºåˆ—åŒ–æ—¶è¯·ä½¿ç”¨linkedHashMapï¼Œä¿è¯æœ‰åº',
  `enable` tinyint(1) NOT NULL DEFAULT '1' COMMENT 'æ˜¯å¦æœ‰æ•ˆï¼Œ0æ— æ•ˆï¼Œ1æœ‰æ•ˆ',
  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'æ·»åŠ æ—¶é—´',
  `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æœ€åä¿®æ”¹æ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `key_spu_id` (`spu_id`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=27359021554 DEFAULT CHARSET=utf8 COMMENT='skuè¡¨,è¯¥è¡¨è¡¨ç¤ºå…·ä½“çš„å•†å“å®ä½“,å¦‚é»‘è‰²çš„ 64gçš„iphone 8';
```



ç‰¹åˆ«éœ€è¦æ³¨æ„çš„æ˜¯skuè¡¨ä¸­çš„`indexes`å­—æ®µå’Œ`own_spec`å­—æ®µã€‚skuä¸­åº”è¯¥ä¿å­˜ç‰¹æœ‰è§„æ ¼å‚æ•°çš„å€¼ï¼Œå°±åœ¨è¿™ä¸¤ä¸ªå­—æ®µä¸­ã€‚



### 1.4.2.skuä¸­çš„ç‰¹æœ‰è§„æ ¼å‚æ•°

#### 1.4.2.1.indexeså­—æ®µ

åœ¨SPUè¡¨ä¸­ï¼Œå·²ç»å¯¹ç‰¹æœ‰è§„æ ¼å‚æ•°åŠå¯é€‰é¡¹è¿›è¡Œäº†ä¿å­˜ï¼Œç»“æ„å¦‚ä¸‹ï¼š

```json
{
    "4": [
        "é¦™æ§Ÿé‡‘",
        "æ¨±èŠ±ç²‰",
        "ç£¨ç ‚é»‘"
    ],
    "12": [
        "2GB",
        "3GB"
    ],
    "13": [
        "16GB",
        "32GB"
    ]
}
```

è¿™äº›ç‰¹æœ‰å±æ€§å¦‚æœæ’åˆ—ç»„åˆï¼Œä¼šäº§ç”Ÿ12ä¸ªä¸åŒçš„SKUï¼Œè€Œä¸åŒçš„SKUï¼Œå…¶å±æ€§å°±æ˜¯ä¸Šé¢å¤‡é€‰é¡¹ä¸­çš„ä¸€ä¸ªã€‚

æ¯”å¦‚ï¼š

- çº¢ç±³4Xï¼Œé¦™æ§Ÿé‡‘ï¼Œ2GBå†…å­˜ï¼Œ16GBå­˜å‚¨
- çº¢ç±³4Xï¼Œç£¨ç ‚é»‘ï¼Œ2GBå†…å­˜ï¼Œ32GBå­˜å‚¨

ä½ ä¼šå‘ç°ï¼Œæ¯ä¸€ä¸ªå±æ€§å€¼ï¼Œå¯¹åº”äºSPUoptionsæ•°ç»„çš„ä¸€ä¸ªé€‰é¡¹ï¼Œå¦‚æœæˆ‘ä»¬è®°å½•ä¸‹è§’æ ‡ï¼Œå°±æ˜¯è¿™æ ·ï¼š

- çº¢ç±³4Xï¼Œ0,0,0
- çº¢ç±³4Xï¼Œ2,0,1

æ—¢ç„¶å¦‚æ­¤ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥å°†ä¸åŒè§’æ ‡ä¸²è”èµ·æ¥ï¼Œä½œä¸ºSPUä¸‹ä¸åŒSKUçš„æ ‡ç¤ºã€‚è¿™å°±æ˜¯æˆ‘ä»¬çš„indexeså­—æ®µã€‚

 ![1526266901335](assets/1526266901335.png)

è¿™ä¸ªè®¾è®¡åœ¨å•†å“è¯¦æƒ…é¡µä¼šç‰¹åˆ«æœ‰ç”¨ï¼š

 ![1526267180997](assets/1526267180997.png)

å½“ç”¨æˆ·ç‚¹å‡»é€‰ä¸­ä¸€ä¸ªç‰¹æœ‰å±æ€§ï¼Œä½ å°±èƒ½æ ¹æ® è§’æ ‡å¿«é€Ÿå®šä½åˆ°skuã€‚

#### 1.4.2.2.own_specå­—æ®µ

çœ‹ç»“æ„ï¼š

```json
{"4":"é¦™æ§Ÿé‡‘","12":"2GB","13":"16GB"}
```

ä¿å­˜çš„æ˜¯ç‰¹æœ‰å±æ€§çš„é”®å€¼å¯¹ã€‚

SPUä¸­ä¿å­˜çš„æ˜¯å¯é€‰é¡¹ï¼Œä½†ä¸ç¡®å®šå…·ä½“çš„å€¼ï¼Œè€ŒSKUä¸­çš„ä¿å­˜çš„å°±æ˜¯å…·ä½“çš„å€¼ã€‚



## 1.5.å¯¼å…¥å›¾ç‰‡ä¿¡æ¯

ç°åœ¨å•†å“è¡¨ä¸­è™½ç„¶æœ‰æ•°æ®ï¼Œä½†æ˜¯æ‰€æœ‰çš„å›¾ç‰‡ä¿¡æ¯éƒ½æ˜¯æ— æ³•è®¿é—®çš„ï¼Œçœ‹çœ‹æ•°æ®åº“ä¸­ç»™å‡ºçš„å›¾ç‰‡ä¿¡æ¯ï¼š

![1552812056893](assets/1552812056893.png)

ç°åœ¨è¿™äº›å›¾ç‰‡çš„åœ°å€æŒ‡å‘çš„æ˜¯`http://image.leyou.com`è¿™ä¸ªåŸŸåã€‚è€Œä¹‹å‰æˆ‘ä»¬åœ¨nginxä¸­åšäº†åå‘ä»£ç†ï¼ŒæŠŠå›¾ç‰‡åœ°å€æŒ‡å‘äº†é˜¿é‡Œå·´å·´çš„OSSæœåŠ¡ã€‚

æˆ‘ä»¬å¯ä»¥åœ¨è¯¾å‰èµ„æ–™ä¸­æ‰¾åˆ°è¿™äº›å•†å“çš„å›¾ç‰‡ï¼š

![1552812290689](assets/1552812290689.png)

å¹¶ä¸”æŠŠè¿™äº›å›¾ç‰‡æ”¾åˆ°nginxç›®å½•ï¼Œç„¶åç”±nginxå¯¹å…¶åŠ è½½å³å¯ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æŠŠå›¾ç‰‡æ”¾åˆ°nginx/htmlç›®å½•ï¼Œå¹¶ä¸”è§£å‹ç¼©ï¼š

![1552812370270](assets/1552812370270.png)



ä¿®æ”¹Nginxä¸­ï¼Œæœ‰å…³`image.leyou.com`çš„ç›‘å¬é…ç½®ï¼Œä½¿nginxæ¥åŠ è½½å›¾ç‰‡åœ°å€ï¼š

```nginx
server {
	listen       80;
	server_name  image.leyou.com;
	location /images { # ç›‘å¬ä»¥/imagesæ‰“å¤´çš„è·¯å¾„ï¼Œ
		root	html;
	}
	location / {
		proxy_pass   https://ly-images.oss-cn-shanghai.aliyuncs.com;
	}
}
```

å†æ¬¡æµ‹è¯•ï¼š

![1552812690883](assets/1552812690883.png)



# 2.å•†å“æŸ¥è¯¢

## é‡ç‚¹ï¼šå®Œæˆjavaä»£ç ï¼Œå¹¶è¿”å›æ­£ç¡®åˆ†é¡µç»“æœ

## 2.1.æ•ˆæœé¢„è§ˆ

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®ç°å•†å“ç®¡ç†çš„é¡µé¢ï¼Œå…ˆçœ‹ä¸‹æˆ‘ä»¬è¦å®ç°çš„æ•ˆæœï¼š

![1526268595873](assets/1526268595873.png)

å¯ä»¥çœ‹å‡ºæ•´ä½“æ˜¯ä¸€ä¸ªtableï¼Œç„¶åæœ‰æ–°å¢æŒ‰é’®ã€‚æ˜¯ä¸æ˜¯è·Ÿæ˜¨å¤©å†™å“ç‰Œç®¡ç†å¾ˆåƒï¼Ÿ

## 2.2.é¡µé¢è¯·æ±‚

ç‚¹å‡»é¡µé¢èœå•ä¸­çš„å•†å“åˆ—è¡¨é¡µé¢ï¼š

![1552813666829](assets/1552813666829.png) 

é¡µé¢å³ä¾§æ˜¯ä¸€ä¸ªç©ºç™½çš„æ•°æ®è¡¨æ ¼ï¼š

![1552814807340](assets/1552814807340.png)

çœ‹åˆ°æµè§ˆå™¨å‘èµ·å·²ç»å‘èµ·äº†æŸ¥è¯¢å•†å“æ•°æ®çš„è¯·æ±‚ï¼š

 ![1528082212618](assets/1528082212618.png)

å› æ­¤æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç¼–å†™æ¥å£å³å¯ã€‚



## 2.3.åå°æä¾›æ¥å£

é¡µé¢å·²ç»å‡†å¤‡å¥½ï¼Œæ¥ä¸‹æ¥åœ¨åå°æä¾›åˆ†é¡µæŸ¥è¯¢SPUçš„åŠŸèƒ½ï¼š

### 2.3.1.å®ä½“ç±»

> SPU

```java
package com.leyou.item.entity;

import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.extension.activerecord.Model;
import java.util.Date;
import com.baomidou.mybatisplus.annotation.TableId;
import java.io.Serializable;
import lombok.Data;
import lombok.EqualsAndHashCode;
import lombok.experimental.Accessors;

/**
 * <p>
 * spuè¡¨ï¼Œè¯¥è¡¨æè¿°çš„æ˜¯ä¸€ä¸ªæŠ½è±¡æ€§çš„å•†å“
 * </p>
 *
 * @author HeiMa
 */
@Data
@EqualsAndHashCode(callSuper = false)
@Accessors(chain = true)
public class TbSpu extends Model<TbSpu> {

private static final long serialVersionUID=1L;

    /**
     * spu id
     */
    @TableId(value = "id", type = IdType.AUTO)
    private Long id;

    /**
     * å•†å“åç§°
     */
    private String name;

    /**
     * å‰¯æ ‡é¢˜ï¼Œä¸€èˆ¬æ˜¯ä¿ƒé”€ä¿¡æ¯
     */
    private String subTitle;

    /**
     * 1çº§ç±»ç›®id
     */
    private Long cid1;

    /**
     * 2çº§ç±»ç›®id
     */
    private Long cid2;

    /**
     * 3çº§ç±»ç›®id
     */
    private Long cid3;

    /**
     * å•†å“æ‰€å±å“ç‰Œid
     */
    private Long brandId;

    /**
     * æ˜¯å¦ä¸Šæ¶ï¼Œ0ä¸‹æ¶ï¼Œ1ä¸Šæ¶
     */
    private Boolean saleable;

    /**
     * æ·»åŠ æ—¶é—´
     */
    private Date createTime;

    /**
     * æœ€åä¿®æ”¹æ—¶é—´
     */
    private Date updateTime;


    @Override
    protected Serializable pkVal() {
        return this.id;
    }

}

```



> SPUè¯¦æƒ…

```java
package com.leyou.item.entity;

import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableId;
import com.baomidou.mybatisplus.extension.activerecord.Model;
import java.util.Date;
import java.io.Serializable;
import lombok.Data;
import lombok.EqualsAndHashCode;
import lombok.experimental.Accessors;


@Data
@EqualsAndHashCode(callSuper = false)
@Accessors(chain = true)
public class TbSpuDetail extends Model<TbSpuDetail> {

private static final long serialVersionUID=1L;

    /**
    *æ³¨æ„è¿™é‡Œ ä½¿ç”¨ IdType.INPUT
    *è¡¨ç¤º ä¸»é”®id ä¸æ˜¯è‡ªå¢ï¼Œè€Œæ˜¯ç”±ç”¨æˆ·è¾“å…¥
    **/
    @TableId(type = IdType.INPUT)
    private Long spuId;

    /**
     * å•†å“æè¿°ä¿¡æ¯
     */
    private String description;

    /**
     * é€šç”¨è§„æ ¼å‚æ•°æ•°æ®
     */
    private String genericSpec;

    /**
     * ç‰¹æœ‰è§„æ ¼å‚æ•°åŠå¯é€‰å€¼ä¿¡æ¯ï¼Œjsonæ ¼å¼
     */
    private String specialSpec;

    /**
     * åŒ…è£…æ¸…å•
     */
    private String packingList;

    /**
     * å”®åæœåŠ¡
     */
    private String afterService;

    private Date createTime;

    private Date updateTime;


    @Override
    protected Serializable pkVal() {
        return this.spuId;
    }

}

```

### 2.3.2.è¯·æ±‚ä¸šåŠ¡åˆ†æ

å…ˆåˆ†æï¼š

- è¯·æ±‚æ–¹å¼ï¼šGET

- è¯·æ±‚è·¯å¾„ï¼š/spu/page

- è¯·æ±‚å‚æ•°ï¼š

  - pageï¼šå½“å‰é¡µ
  - rowsï¼šæ¯é¡µå¤§å°
  - keyï¼šè¿‡æ»¤æ¡ä»¶
  - saleableï¼šä¸Šæ¶æˆ–ä¸‹æ¶

- è¿”å›ç»“æœï¼šé€šè¿‡é¡µé¢èƒ½çœ‹å‡ºæ¥ï¼ŒæŸ¥è¯¢è¦å±•ç¤ºçš„æ•°æ®éƒ½æ˜¯SPUæ•°æ®ï¼Œè€Œä¸”å› ä¸ºæ˜¯åˆ†é¡µæŸ¥è¯¢ï¼Œæˆ‘ä»¬å¯ä»¥è¿”å›ä¸ä¹‹å‰å“ç‰ŒæŸ¥è¯¢ä¸€æ ·çš„PageResultã€‚

  - è¦æ³¨æ„ï¼Œé¡µé¢å±•ç¤ºçš„ä¸­éœ€è¦æ˜¯å•†å“åˆ†ç±»å’Œå“ç‰Œåç§°ï¼Œè€ŒSPUè¡¨ä¸­ä¸­ä¿å­˜çš„æ˜¯idï¼Œæˆ‘ä»¬éœ€è¦åœ¨DTOä¸­å¤„ç†è¿™äº›å­—æ®µã€‚

    æˆ‘ä»¬å¯ä»¥å¯¹Spuæ‹“å±•categoryNameå’ŒbrandNameå±æ€§ï¼š

    ```java
    @Data
    public class SpuDTO {
        private Long id;
        private Long brandId;
        private Long cid1;// 1çº§ç±»ç›®
        private Long cid2;// 2çº§ç±»ç›®
        private Long cid3;// 3çº§ç±»ç›®
        private String name;// åç§°
        private String subTitle;// å­æ ‡é¢˜
        private Boolean saleable;// æ˜¯å¦ä¸Šæ¶
        private Date createTime;// åˆ›å»ºæ—¶é—´
        private String categoryName; // å•†å“åˆ†ç±»åç§°æ‹¼æ¥
        private String brandName;// å“ç‰Œåç§°
    
        /**
         * æ–¹ä¾¿åŒæ—¶è·å–3çº§åˆ†ç±»
         * @return
         */
        @JsonIgnore //åºåˆ—åŒ–æ—¶ï¼Œä¸ä¼šå¯¹è¿™ä¸ªæ–¹æ³•è¿›è¡Œåºåˆ—åŒ–
        public List<Long> getCategoryIds(){
            return Arrays.asList(cid1, cid2, cid3);
        }
    }
    ```
    
    éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œé€šè¿‡`@JsonIgnore`æ³¨è§£æ¥å¿½ç•¥è¿™ä¸ª`getCategoryIds`æ–¹æ³•ï¼Œé¿å…å°†å…¶åºåˆ—åŒ–åˆ°JSONç»“æœ
    

å› æ­¤è¿™é‡Œéœ€è¦åœ¨`ly-item-pojo`ä¸­å¼•å…¥Jacksonä¾èµ–ï¼š
    
```xml
    <dependencies>
    <dependency>
            <groupId>com.fasterxml.jackson.core</groupId>
            <artifactId>jackson-annotations</artifactId>
            <version>2.9.0</version>
            <scope>compile</scope>
        </dependency>
    </dependencies>
```

â€‹    

### 2.3.3 åˆ†ç±»å’Œå“ç‰ŒæŸ¥è¯¢åŠŸèƒ½

åœ¨SpuDTOä¸­ï¼Œéœ€è¦çš„categoryNameå’ŒbrandNameå±æ€§ã€‚è€ŒSpuä¸­åªæœ‰å¤šçº§åˆ†ç±»idï¼šcid1ã€cid2ã€cid3ï¼Œå¦å¤–è¿˜æœ‰brandIdã€‚æ‰€ä»¥æˆ‘ä»¬å¿…é¡»å¢åŠ æ–°çš„åŠŸèƒ½ï¼š

- æ ¹æ®åˆ†ç±»idçš„é›†åˆæŸ¥è¯¢å•†å“åˆ†ç±»
- æ ¹æ®å“ç‰ŒidæŸ¥è¯¢å“ç‰Œ

### 2.3.5.ç¼–å†™controllerä»£ç ï¼š

æˆ‘ä»¬æŠŠä¸å•†å“ç›¸å…³çš„ä¸€åˆ‡ä¸šåŠ¡æ¥å£éƒ½æ”¾åˆ°ä¸€èµ·ï¼Œèµ·åä¸ºGoodsControllerï¼Œä¸šåŠ¡å±‚ä¹Ÿæ˜¯è¿™æ ·

```java
package com.leyou.item.web;

import com.leyou.common.vo.PageResult;
import com.leyou.item.dto.SpuDTO;
import com.leyou.item.service.GoodsService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class GoodsController {

    @Autowired
    private GoodsService goodsService;

    /**
     * æŸ¥è¯¢spuåˆ—è¡¨
     * @param page
     * @param rows
     * @param key
     * @param saleable
     * @return
     */
    @GetMapping("/spu/page")
    public ResponseEntity<PageResult> findSpuByPage(
        @RequestParam(name = "page",defaultValue = "1") Integer page,
                                                    
        @RequestParam(name = "rows",defaultValue = "5") Integer rows,                                         
        @RequestParam(name = "key",required = false) String key,                                    
        @RequestParam(name = "saleable",required = false) Boolean saleable){
        PageResult<SpuDTO> pageResult = goodsService.findSpuByPage(page,rows,key,saleable);
        return ResponseEntity.ok(pageResult);
    }
}
```



### 2.3.6.service

æ‰€æœ‰å•†å“ç›¸å…³çš„ä¸šåŠ¡ï¼ˆåŒ…æ‹¬SPUå’ŒSKUï¼‰æ”¾åˆ°ä¸€ä¸ªä¸šåŠ¡ä¸‹ï¼šGoodsServiceã€‚

```java
public PageResult<SpuDTO> findSpuByPage(Integer page, Integer rows, String key, Boolean saleable) {
       //åˆ†é¡µä¿¡æ¯
        IPage<TbSpu> spuPage = new Page<>(page,rows);
        //æŸ¥è¯¢æ¡ä»¶
        QueryWrapper<TbSpu> queryWrapper = new QueryWrapper<>();
        //æ¨¡ç³ŠæŸ¥è¯¢ å•†å“ åç§°
        if(!StringUtils.isEmpty(key)){
            queryWrapper.lambda().like(TbSpu::getName,key);
        }
        //æ˜¯å¦ä¸Šä¸‹æ¶
        if(saleable != null){
            queryWrapper.lambda().eq(TbSpu::getSaleable,saleable);
        }
        //æ’åº
        queryWrapper.lambda().orderByDesc(TbSpu::getUpdateTime);
        //åˆ†é¡µæŸ¥è¯¢
        IPage<TbSpu> spuIPage = spuService.page(spuPage, queryWrapper);
        if(spuIPage == null || CollectionUtils.isEmpty(spuIPage.getRecords())){
            throw  new LyException(ExceptionEnum.GOODS_NOT_FOUND);
        }
        //è½¬bean
        List<SpuDTO> spuDTOS = BeanHelper.copyWithCollection(spuIPage.getRecords(), SpuDTO.class);
        //å¤„ç† å“ç‰Œåç§°å’Œåˆ†ç±»åç§°
        this.handleBrandAndCategoryName(spuDTOS);
        //åŒ…è£…PageResult
        PageResult<SpuDTO> pageResult = new PageResult<>(spuDTOS,spuIPage.getTotal(),spuIPage.getPages());
        return pageResult;
    }

    private void handleBrandAndCategoryName(List<SpuDTO> spuDTOList){
        for (SpuDTO spuDTO : spuDTOList) {
            //å•†å“æ‰€å± åˆ†ç±»
            List<Long> categoryIdList = spuDTO.getCategorys();
            Collection<TbCategory> tbCategoryCollection = categoryService.listByIds(categoryIdList);
            String categoryName = tbCategoryCollection.stream().map(TbCategory::getName).collect(Collectors.joining("/"));
            spuDTO.setCategoryName(categoryName);
            //å•†å“å“ç‰Œ
            Long brandId = spuDTO.getBrandId();
            TbBrand brand = brandService.getById(brandId);
            spuDTO.setBrandName(brand.getName());

        }
    }
```



## 2.4.æµ‹è¯•

åˆ·æ–°é¡µé¢ï¼ŒæŸ¥çœ‹æ•ˆæœï¼š

![1552824903094](assets/1552824903094.png)



åŸºæœ¬ä¸é¢„è§ˆçš„æ•ˆæœä¸€è‡´ï¼ŒOKï¼



# 3.å•†å“æ–°å¢

## é‡ç‚¹ï¼šäº†è§£å•†å“æ–°å¢å¤„ç†çš„è¡¨ï¼Œè¡¨ä¹‹é—´çš„å…³ç³»ï¼Œå¹¶å®Œæˆjavaä»£ç ç¼–å†™ï¼Œæ­£ç¡®å¤„ç†ä¸šåŠ¡

## 3.1.é¡µé¢é¢„è§ˆ

å½“æˆ‘ä»¬ç‚¹å‡»æ–°å¢å•†å“æŒ‰é’®ï¼š

 ![1528083727447](assets/1528083727447.png)

å°±ä¼šå‡ºç°ä¸€ä¸ªå¼¹çª—ï¼š

![1528086595597](assets/1528086595597.png)

é‡Œé¢æŠŠå•†å“çš„æ•°æ®åˆ†ä¸ºäº†4éƒ¨åˆ†æ¥å¡«å†™ï¼š

- åŸºæœ¬ä¿¡æ¯ï¼šä¸»è¦æ˜¯ä¸€äº›ç®€å•çš„æ–‡æœ¬æ•°æ®ï¼ŒåŒ…å«äº†SPUå’ŒSpuDetailçš„éƒ¨åˆ†æ•°æ®ï¼Œå¦‚
  - å•†å“åˆ†ç±»ï¼šæ˜¯SPUä¸­çš„`cid1`ï¼Œ`cid2`ï¼Œ`cid3`å±æ€§
  - å“ç‰Œï¼šæ˜¯spuä¸­çš„`brandId`å±æ€§
  - æ ‡é¢˜ï¼šæ˜¯spuä¸­çš„`title`å±æ€§
  - å­æ ‡é¢˜ï¼šæ˜¯spuä¸­çš„`subTitle`å±æ€§
  - å”®åæœåŠ¡ï¼šæ˜¯SpuDetailä¸­çš„`afterService`å±æ€§
  - åŒ…è£…åˆ—è¡¨ï¼šæ˜¯SpuDetailä¸­çš„`packingList`å±æ€§
- å•†å“æè¿°ï¼šæ˜¯SpuDetailä¸­çš„`description`å±æ€§ï¼Œæ•°æ®è¾ƒå¤šï¼Œæ‰€ä»¥å•ç‹¬æ”¾ä¸€ä¸ªé¡µé¢
- è§„æ ¼å‚æ•°ï¼šå•†å“è§„æ ¼ä¿¡æ¯ï¼Œå¯¹åº”SpuDetailä¸­çš„`genericSpec`å±æ€§
- SKUå±æ€§ï¼šspuä¸‹çš„æ‰€æœ‰Skuä¿¡æ¯

ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªé¡µé¢åŒ…å«äº†å•†å“ç›¸å…³çš„å››å¼ è¡¨ä¸­çš„æ•°æ®ï¼š

- tb_spu
- tb_spu_detail
- tb_sku
- tb_stock

## 3.3.åŸºæœ¬æ•°æ®

æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹åŸºæœ¬æ•°æ®ï¼š

![1528086595597](assets/1528086595597.png)

### 3.3.1.å•†å“åˆ†ç±»

å•†å“åˆ†ç±»çš„çº§è”é€‰æ¡†æˆ‘ä»¬ä¹‹å‰åœ¨å“ç‰ŒæŸ¥è¯¢å·²ç»åšè¿‡ï¼Œæ˜¯è¦æ ¹æ®åˆ†ç±»çš„pidæŸ¥è¯¢åˆ†ç±»ï¼Œæ‰€ä»¥è¿™é‡Œçš„çº§è”é€‰æ¡†å·²ç»å®ç°å®Œæˆï¼š

åˆ·æ–°é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°è¯·æ±‚å·²ç»å‘å‡ºï¼š

 ![1528101483023](assets/1528101483023.png)

 ![1528101622952](assets/1528101622952.png)



 ![1528101649596](assets/1528101649596.png)

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œé€‰ä¸­ä»¥åä¼šæ˜¾ç¤º3çº§åˆ†ç±»ï¼Œå› ä¸ºæ•°æ®åº“ä¸­ä¿å­˜çš„å°±æ˜¯å•†å“çš„1~3çº§ç±»ç›®ã€‚

### 3.3.2.å“ç‰Œé€‰æ‹©-åå°æ¥å£

å“ç‰Œä¹Ÿæ˜¯ä¸€ä¸ªä¸‹æ‹‰é€‰æ¡†ï¼Œä¸è¿‡å…¶é€‰é¡¹æ˜¯ä¸ç¡®å®šçš„ï¼Œåªæœ‰å½“ç”¨æˆ·é€‰æ‹©äº†å•†å“åˆ†ç±»ï¼Œæ‰ä¼šæŠŠè¿™ä¸ªåˆ†ç±»ä¸‹çš„æ‰€æœ‰å“ç‰Œå±•ç¤ºå‡ºæ¥ã€‚

æ‰€ä»¥é¡µé¢ç¼–å†™äº†watchå‡½æ•°ï¼Œç›‘æ§å•†å“åˆ†ç±»çš„å˜åŒ–ï¼Œæ¯å½“å•†å“åˆ†ç±»å€¼æœ‰å˜åŒ–ï¼Œå°±ä¼šå‘èµ·è¯·æ±‚ï¼ŒæŸ¥è¯¢å“ç‰Œåˆ—è¡¨ã€‚åˆ·æ–°é¡µé¢ï¼Œå½“é€‰ä¸­ä¸€ä¸ªåˆ†ç±»æ—¶ï¼Œå¯ä»¥çœ‹åˆ°è¯·æ±‚å‘èµ·ï¼š

![1552822964914](assets/1552822964914.png)

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åªè¦ç¼–å†™åå°æ¥å£ï¼Œæ ¹æ®å•†å“åˆ†ç±»idï¼ŒæŸ¥è¯¢å¯¹åº”å“ç‰Œå³å¯ã€‚

#### åå°æ¥å£

é¡µé¢éœ€è¦å»åå°æŸ¥è¯¢å“ç‰Œä¿¡æ¯ï¼Œæˆ‘ä»¬è‡ªç„¶éœ€è¦æä¾›ï¼š

> controller

```java
/**
     * æ ¹æ®åˆ†ç±»IDæŸ¥è¯¢å“ç‰Œåˆ—è¡¨
     * @param categoryId å•†å“åˆ†ç±»id
     * @return è¯¥åˆ†ç±»ä¸‹çš„å“ç‰Œçš„é›†åˆ
     */
@GetMapping("/of/category")
public ResponseEntity<List<BrandDTO>> queryByCategoryId(@RequestParam("id") Long categoryId) {
    return ResponseEntity.ok(this.brandService.queryByCategoryId(categoryId));
}
```

> service

```java
@Override
    public List<BrandDTO> findBrandByCategoryId(Long cid) {
        List<TbBrand> brandList = this.baseMapper.selectBrandJoinCategory(cid);
        if(CollectionUtils.isEmpty(brandList)){
            throw new LyException(ExceptionEnum.BRAND_NOT_FOUND);
        }
        return BeanHelper.copyWithCollection(brandList,BrandDTO.class);
    }
```



> mapper

æ ¹æ®åˆ†ç±»æŸ¥è¯¢å“ç‰Œæœ‰ä¸­é—´è¡¨ï¼Œéœ€è¦è‡ªå·±ç¼–å†™Sqlï¼š

```java
@Select("SELECT b.* FROM tb_category_brand a ,tb_brand b WHERE a.`brand_id` = b.`id` AND a.`category_id`=#{cid}")
    List<TbBrand> selectBrandJoinCategory(@Param("cid") Long cid);
```



æ•ˆæœï¼š

 ![1528102194745](assets/1528102194745.png)

### 3.3.3.å…¶å®ƒæ–‡æœ¬æ¡†

å‰©ä½™çš„å‡ ä¸ªå±æ€§ï¼šæ ‡é¢˜ã€å­æ ‡é¢˜ç­‰éƒ½æ˜¯æ™®é€šæ–‡æœ¬æ¡†ï¼Œæˆ‘ä»¬ç›´æ¥å¡«å†™å³å¯ï¼Œæ²¡æœ‰éœ€è¦ç‰¹åˆ«æ³¨æ„çš„ã€‚



## 3.4.å•†å“æè¿°-å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆäº†è§£ï¼‰

å•†å“æè¿°ä¿¡æ¯æ¯”è¾ƒå¤æ‚ï¼Œè€Œä¸”å›¾æ–‡å¹¶èŒ‚ï¼Œç”šè‡³åŒ…æ‹¬è§†é¢‘ã€‚

è¿™æ ·çš„å†…å®¹ï¼Œä¸€èˆ¬éƒ½ä¼šä½¿ç”¨å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ã€‚

### 3.4.1.ä»€ä¹ˆæ˜¯å¯Œæ–‡æœ¬ç¼–è¾‘å™¨

ç™¾åº¦ç™¾ç§‘ï¼š

![1526290914491](assets/1526290914491.png)

é€šä¿—æ¥è¯´ï¼šå¯Œæ–‡æœ¬ï¼Œå°±æ˜¯æ¯”è¾ƒä¸°å¯Œçš„æ–‡æœ¬ç¼–è¾‘å™¨ã€‚æ™®é€šçš„æ¡†åªèƒ½è¾“å…¥æ–‡å­—ï¼Œè€Œå¯Œæ–‡æœ¬è¿˜èƒ½ç»™æ–‡å­—åŠ é¢œè‰²æ ·å¼ç­‰ã€‚

å¯Œæ–‡æœ¬ç¼–è¾‘å™¨æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚ï¼šKindEditorã€Ueditorã€‚ä½†å¹¶ä¸åŸç”Ÿæ”¯æŒvue

ä½†æ˜¯æˆ‘ä»¬ä»Šå¤©è¦è¯´çš„ï¼Œæ˜¯ä¸€æ¬¾æ”¯æŒVueçš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼š`vue-quill-editor`



### 1.4.2.Vue-Quill-Editor

GitHubçš„ä¸»é¡µï¼šhttps://github.com/surmon-china/vue-quill-editor

Vue-Quill-Editoræ˜¯ä¸€ä¸ªåŸºäºQuillçš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼š[Quillçš„å®˜ç½‘](https://quilljs.com/)

![1526291232678](assets/1526291232678.png)



### 1.4.3.ä½¿ç”¨æŒ‡å—

ä½¿ç”¨éå¸¸ç®€å•ï¼š

ç¬¬ä¸€æ­¥ï¼šå®‰è£…ï¼Œä½¿ç”¨npmå‘½ä»¤ï¼š

```
npm install vue-quill-editor --save

```

ç¬¬äºŒæ­¥ï¼šåŠ è½½ï¼Œåœ¨jsä¸­å¼•å…¥ï¼š

å…¨å±€ä½¿ç”¨ï¼š

```js
import Vue from 'vue'
import VueQuillEditor from 'vue-quill-editor'

const options = {}; /* { default global options } */

Vue.use(VueQuillEditor, options); // optionså¯é€‰
```



å±€éƒ¨ä½¿ç”¨ï¼š

```js
import 'quill/dist/quill.core.css'
import 'quill/dist/quill.snow.css'
import 'quill/dist/quill.bubble.css'

import {quillEditor} from 'vue-quill-editor'

var vm = new Vue({
    components:{
        quillEditor
    }
})
```



ç¬¬ä¸‰æ­¥ï¼šé¡µé¢å¼•ç”¨ï¼š

```html
<quill-editor v-model="goods.spuDetail.description" :options="editorOption"/>
```



### 1.4.4.è‡ªå®šä¹‰çš„å¯Œæ–‡æœ¬ç¼–è¾‘å™¨

ä¸è¿‡è¿™ä¸ªç»„ä»¶æœ‰ä¸ªå°é—®é¢˜ï¼Œå°±æ˜¯å›¾ç‰‡ä¸Šä¼ çš„æ— æ³•ç›´æ¥ä¸Šä¼ åˆ°åå°ï¼Œå› æ­¤æˆ‘ä»¬å¯¹å…¶è¿›è¡Œäº†å°è£…ï¼Œæ”¯æŒäº†å›¾ç‰‡çš„ä¸Šä¼ ã€‚

 ![1526296083605.png](assets/1526296083605.png)

ä½¿ç”¨ä¹Ÿéå¸¸ç®€å•ï¼š

```html
<v-stepper-content step="2">
    <v-editor v-model="goods.spuDetail.description" url="/upload/signature" needSignature/>
</v-stepper-content>
```

- urlï¼šæ˜¯å›¾ç‰‡ä¸Šä¼ çš„è·¯å¾„æˆ–è€…ä¸Šä¼ é˜¿é‡ŒOSSæ—¶çš„ç­¾åè·¯å¾„ï¼Œè¿™é‡Œè¾“å…¥çš„æ˜¯ç­¾åè·¯å¾„
- v-modelï¼šåŒå‘ç»‘å®šï¼Œå°†å¯Œæ–‡æœ¬ç¼–è¾‘å™¨çš„å†…å®¹ç»‘å®šåˆ°goods.spuDetail.description



### 1.4.5.æ•ˆæœï¼š

![1526297276667](assets/1526297276667.png)



## 3.5.å•†å“è§„æ ¼å‚æ•°

è§„æ ¼å‚æ•°çš„æŸ¥è¯¢æˆ‘ä»¬ä¹‹å‰ä¹Ÿå·²ç»ç¼–å†™è¿‡æ¥å£ï¼Œå› ä¸ºå•†å“è§„æ ¼å‚æ•°ä¹Ÿæ˜¯ä¸å•†å“åˆ†ç±»ç»‘å®šï¼Œæ‰€ä»¥éœ€è¦åœ¨å•†å“åˆ†ç±»å˜åŒ–åå»æŸ¥è¯¢ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯é€šè¿‡watchç›‘æ§æ¥å®ç°ï¼š

 

å¯ä»¥çœ‹åˆ°è¿™é‡Œæ˜¯æ ¹æ®å•†å“åˆ†ç±»idæŸ¥è¯¢è§„æ ¼å‚æ•°ï¼šSpecParamã€‚æˆ‘ä»¬ä¹‹å‰å†™è¿‡ä¸€ä¸ªæ ¹æ®gidï¼ˆåˆ†ç»„idï¼‰æ¥æŸ¥è¯¢è§„æ ¼å‚æ•°çš„æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å…¶è¿›è¡Œæ‰©å±•ï¼š

> ### æ”¹é€ æŸ¥è¯¢è§„æ ¼å‚æ•°æ¥å£

æˆ‘ä»¬åœ¨åŸæ¥çš„æ ¹æ® gidï¼ˆè§„æ ¼ç»„id)æŸ¥è¯¢è§„æ ¼å‚æ•°çš„æ¥å£ä¸Šï¼Œæ·»åŠ ä¸€ä¸ªå‚æ•°ï¼šcidï¼Œå³å•†å“åˆ†ç±»idã€‚

ç­‰ä¸€ä¸‹ï¼Œ è€ƒè™‘åˆ°ä»¥åå¯èƒ½è¿˜ä¼šæ ¹æ®æ˜¯å¦æœç´¢(searching)å­—æ®µæ¥è¿‡æ»¤ï¼Œæˆ‘ä»¬å¤šæ·»åŠ ä¸€ä¸ªè¿‡æ»¤æ¡ä»¶ï¼š

```java
   /**
     * æŸ¥è¯¢è§„æ ¼å‚æ•°
     * @param gid ç»„id
     * @param cid åˆ†ç±»id
     * @param searching æ˜¯å¦ç”¨äºæœç´¢
     * @return è§„æ ¼ç»„é›†åˆ
     */
    @GetMapping("/params")
    public ResponseEntity<List<SpecParamDTO>> querySpecParams(
            @RequestParam(value = "gid", required = false) Long gid,
            @RequestParam(value = "cid", required = false) Long cid,
            @RequestParam(value = "searching", required = false) Boolean searching
    ) {
        return ResponseEntity.ok(specService.querySpecParams(gid, cid, searching));
    }
```

æ”¹é€ serviceï¼š

```java
public List<SpecParamDTO> findSpecParam(Long gid,Long cid) {
        QueryWrapper<TbSpecParam> queryWrapper = new QueryWrapper<>();
        if(gid != null && gid != 0){
            queryWrapper.lambda().eq(TbSpecParam::getGroupId,gid);
        }
        if(cid != null && cid != 0){
            queryWrapper.lambda().eq(TbSpecParam::getCid,cid);
        }
        List<TbSpecParam> specParamList = specParamService.list(queryWrapper);
        if (CollectionUtils.isEmpty(specParamList)) {
            throw new LyException(ExceptionEnum.SPEC_NOT_FOUND);
        }
        return BeanHelper.copyWithCollection(specParamList,SpecParamDTO.class);

    }
```

å¦‚æœparamä¸­æœ‰å±æ€§ä¸ºnullï¼Œåˆ™ä¸ä¼šå§å±æ€§ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ï¼Œå› æ­¤è¯¥æ–¹æ³•å…·å¤‡é€šç”¨æ€§ï¼Œå³å¯æ ¹æ®gidæŸ¥è¯¢ï¼Œä¹Ÿå¯æ ¹æ®cidæŸ¥è¯¢ã€‚

æµ‹è¯•ï¼š

 ![1529631805801](assets/1529631805801.png)



åˆ·æ–°é¡µé¢æµ‹è¯•ï¼š

 ![1529631887407](assets/1529631887407.png)



## 3.6.SKUä¿¡æ¯

Skuå±æ€§æ˜¯SPUä¸‹çš„æ¯ä¸ªå•†å“çš„ä¸åŒç‰¹å¾ï¼Œå¦‚å›¾ï¼š

![1529656674978](assets/1529656674978.png)

å½“æˆ‘ä»¬å¡«å†™ä¸€äº›å±æ€§åï¼Œä¼šåœ¨é¡µé¢ä¸‹æ–¹ç”Ÿæˆä¸€ä¸ªskuè¡¨æ ¼ï¼Œå¤§å®¶å¯ä»¥è®¡ç®—ä¸‹ä¼šç”Ÿæˆå¤šå°‘ä¸ªä¸åŒå±æ€§çš„Skuå‘¢ï¼Ÿ

å½“ä½ é€‰æ‹©äº†ä¸Šå›¾ä¸­çš„è¿™äº›é€‰é¡¹æ—¶ï¼š

- é¢œè‰²å…±2ç§ï¼šå¤œç©ºé»‘ï¼Œç»šä¸½çº¢
- å†…å­˜å…±2ç§ï¼š4GBï¼Œ6GB
- æœºèº«å­˜å‚¨1ç§ï¼š64GB

æ­¤æ—¶ä¼šäº§ç”Ÿå¤šå°‘ç§SKUå‘¢ï¼Ÿ åº”è¯¥æ˜¯ 2 * 2 * 1 = 4ç§ï¼Œè¿™å…¶å®å°±æ˜¯åœ¨æ±‚ç¬›å¡å°”ç§¯ã€‚

æˆ‘ä»¬ä¼šåœ¨é¡µé¢ä¸‹æ–¹ç”Ÿæˆä¸€ä¸ªskuçš„è¡¨æ ¼ï¼š

![1528856353718](assets/1528856353718.png)

è¿™ä¸ªè¡¨æ ¼ä¸­å°±åŒ…å«äº†ä»¥ä¸Šé¢œè‰²å†…å­˜çš„æ‰€æœ‰å¯èƒ½ç»„åˆï¼Œå‰©ä¸‹çš„ä»·æ ¼ç­‰ä¿¡æ¯å°±éœ€è¦ç”¨æˆ·è‡ªå·±æ¥å®Œæˆäº†ã€‚

æ³¨æ„ï¼Œé¡µé¢ä¸­çš„skuçš„å›¾ç‰‡ä¸Šä¼ ï¼Œé»˜è®¤æ˜¯ä¸Šä¼ åˆ°æœ¬åœ°ï¼Œè¿™æ ·å¯èƒ½ä¸Šä¼ åå°±æ— æ³•æ‰¾åˆ°å›¾ç‰‡ï¼Œéœ€è¦ä¿®æ”¹nginxï¼š

å¦‚æœæ˜¯ä¸Šä¼ åˆ°æœ¬åœ°ï¼Œåˆ™éœ€è¦åœ¨nginxä¸­é…ç½®å›¾ç‰‡åœ°å€çš„åˆ¤æ–­ï¼š

```nginx
server {
	listen       80;
	server_name  image.leyou.com;
	location /images {
		root	html;
	}
	location / {
		root 	html;
		if (!-f $request_filename) {
            proxy_pass http://heima64.oss-cn-shanghai.aliyuncs.com;
            break;
        }
	}
}
```

- `if (!-f $request_filename)`ï¼šåˆ¤æ–­æ˜¯å¦åœ¨æœ¬åœ°èƒ½æ‰¾åˆ°å›¾ç‰‡ï¼Œæ‰¾ä¸åˆ°æ‰åå‘ä»£ç†åˆ°é˜¿é‡Œå»æ‰¾å›¾ç‰‡

 

**å¦‚æœä¸æƒ³ä¿®æ”¹nginx**ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹æˆä¸Šä¼ åˆ°é˜¿é‡Œï¼Œè¿™æ ·nginxå°±æ— éœ€ä¿®æ”¹äº†ï¼š

![1557134693791](assets/1557134693791.png)

å¤§æ¦‚æ˜¯åœ¨119è¡Œã€‚

## 3.7.é¡µé¢è¡¨å•æäº¤

åœ¨skuåˆ—è¡¨çš„ä¸‹æ–¹ï¼Œæœ‰ä¸€ä¸ªæäº¤æŒ‰é’®ï¼š

![1528860775149](assets/1528860775149.png)

ç‚¹å‡»æäº¤ï¼ŒæŸ¥çœ‹æ§åˆ¶å°æäº¤çš„æ•°æ®æ ¼å¼ï¼š

![1552827511270](assets/1552827511270.png)

- æ•´ä½“æ˜¯ä¸€ä¸ªjsonæ ¼å¼æ•°æ®ï¼ŒåŒ…å«Spuè¡¨æ‰€æœ‰æ•°æ®ï¼š

  - brandIdï¼šå“ç‰Œid

  - cid1ã€cid2ã€cid3ï¼šå•†å“åˆ†ç±»id

  - subTitleï¼šå‰¯æ ‡é¢˜

  - nameï¼šå•†å“åç§°

  - spuDetailï¼šæ˜¯ä¸€ä¸ªjsonå¯¹è±¡ï¼Œä»£è¡¨å•†å“è¯¦æƒ…è¡¨æ•°æ®

    ![1552827536439](assets/1552827536439.png)

    - afterServiceï¼šå”®åæœåŠ¡
    - descriptionï¼šå•†å“æè¿°
    - packingListï¼šåŒ…è£…åˆ—è¡¨
    - specialSpecï¼šskuè§„æ ¼å±æ€§æ¨¡æ¿
    - genericSpecï¼šé€šç”¨è§„æ ¼å‚æ•°

  - skusï¼šspuä¸‹çš„æ‰€æœ‰skuæ•°ç»„ï¼Œå…ƒç´ æ˜¯æ¯ä¸ªskuå¯¹è±¡ï¼š

    ![1552827560584](assets/1552827560584.png)

    - titleï¼šæ ‡é¢˜
    - imagesï¼šå›¾ç‰‡
    - priceï¼šä»·æ ¼
    - stockï¼šåº“å­˜
    - ownSpecï¼šç‰¹æœ‰è§„æ ¼å‚æ•°
    - indexesï¼šç‰¹æœ‰è§„æ ¼å‚æ•°çš„ä¸‹æ ‡

## 3.8.åå°å®ç°

### é‡ç‚¹ï¼šæ¸…æ¥šæ–°å¢æ“ä½œ3å¼ è¡¨ï¼Œäº†è§£@TableIdæ³¨è§£çš„ä½œç”¨

### 3.8.1.å®ä½“ç±»

> Sku

```java
@Data
@EqualsAndHashCode(callSuper = false)
@Accessors(chain = true)
public class TbSku extends Model<TbSku> {

private static final long serialVersionUID=1L;

    /**
     * sku id
     */
    @TableId(value = "id", type = IdType.AUTO)
    private Long id;

    /**
     * spu id
     */
    private Long spuId;

    /**
     * å•†å“æ ‡é¢˜
     */
    private String title;

    /**
     * å•†å“çš„å›¾ç‰‡ï¼Œå¤šä¸ªå›¾ç‰‡ä»¥â€˜,â€™åˆ†å‰²
     */
    private String images;

    /**
     * åº“å­˜
     */
    private Integer stock;

    /**
     * é”€å”®ä»·æ ¼ï¼Œå•ä½ä¸ºåˆ†
     */
    private Long price;

    /**
     * ç‰¹æœ‰è§„æ ¼å±æ€§åœ¨spuå±æ€§æ¨¡æ¿ä¸­çš„å¯¹åº”ä¸‹æ ‡ç»„åˆ
     */
    private String indexes;

    /**
     * skuçš„ç‰¹æœ‰è§„æ ¼å‚æ•°é”®å€¼å¯¹ï¼Œjsonæ ¼å¼ï¼Œååºåˆ—åŒ–æ—¶è¯·ä½¿ç”¨linkedHashMapï¼Œä¿è¯æœ‰åº
     */
    private String ownSpec;

    /**
     * æ˜¯å¦æœ‰æ•ˆï¼Œ0æ— æ•ˆï¼Œ1æœ‰æ•ˆ
     */
    private Boolean enable;

    /**
     * æ·»åŠ æ—¶é—´
     */
    private Date createTime;

    /**
     * æœ€åä¿®æ”¹æ—¶é—´
     */
    private Date updateTime;


    @Override
    protected Serializable pkVal() {
        return this.id;
    }

}

```



ç„¶åæ˜¯å¯¹åº”çš„DTOï¼š

```java
@Data
public class SkuDTO {
    private Long id;
    private Long spuId;
    private String title;
    private String images;
    private Long price;
    private String ownSpec;// å•†å“ç‰¹æ®Šè§„æ ¼çš„é”®å€¼å¯¹
    private String indexes;// å•†å“ç‰¹æ®Šè§„æ ¼çš„ä¸‹æ ‡
    private Boolean enable;// æ˜¯å¦æœ‰æ•ˆï¼Œé€»è¾‘åˆ é™¤ç”¨
    private Integer stock; // åº“å­˜
}
```



### 3.8.2.è¯·æ±‚åˆ†æ

å››ä¸ªé—®é¢˜ï¼š

- è¯·æ±‚æ–¹å¼ï¼šPOST
- è¯·æ±‚è·¯å¾„ï¼š/goods
- è¯·æ±‚å‚æ•°ï¼šSpuDTOçš„jsonæ ¼å¼çš„å¯¹è±¡ï¼Œä½†æ˜¯è¦åŒ…å«spuDetailå’ŒSkué›†åˆã€‚æˆ‘ä»¬éœ€è¦æ‹“å±•SpuDTOï¼Œæ¥æ¥æ”¶å…¶ä¸­çš„æ•°æ®
- è¿”å›ç±»å‹ï¼šæ— 

é¦–å…ˆè¦å®šä¹‰ä¸€ä¸ªSpuDetailDTOï¼š

```java
@Data
public class SpuDetailDTO {
    private Long spuId;// å¯¹åº”çš„SPUçš„id
    private String description;// å•†å“æè¿°
    private String specialSpec;// å•†å“ç‰¹æ®Šè§„æ ¼çš„åç§°åŠå¯é€‰å€¼æ¨¡æ¿
    private String genericSpec;// å•†å“çš„å…¨å±€è§„æ ¼å±æ€§
    private String packingList;// åŒ…è£…æ¸…å•
    private String afterService;// å”®åæœåŠ¡
}
```

ç„¶åä¿®æ”¹SpuDTOï¼Œåœ¨é‡Œé¢åŒ…å«SpuDetailå’ŒSkuçš„é›†åˆ

```java
package com.leyou.item.dto;

import com.fasterxml.jackson.annotation.JsonIgnore;
import lombok.Data;
import lombok.EqualsAndHashCode;
import lombok.experimental.Accessors;

import java.util.Arrays;
import java.util.List;

/**
 * <p>
 * spuè¡¨ï¼Œè¯¥è¡¨æè¿°çš„æ˜¯ä¸€ä¸ªæŠ½è±¡æ€§çš„å•†å“ï¼Œæ¯”å¦‚ iphone8
 * </p>
 *
 * @author HM
 * @since 2019-12-23
 */
@Data
@EqualsAndHashCode(callSuper = false)
@Accessors(chain = true)
public class SpuDTO {


    /**
     * spu id
     */
    private Long id;

    /**
     * å•†å“åç§°
     */
    private String name;

    /**
     * å‰¯æ ‡é¢˜ï¼Œä¸€èˆ¬æ˜¯ä¿ƒé”€ä¿¡æ¯
     */
    private String subTitle;

    /**
     * 1çº§ç±»ç›®id
     */
    private Long cid1;

    /**
     * 2çº§ç±»ç›®id
     */
    private Long cid2;

    /**
     * 3çº§ç±»ç›®id
     */
    private Long cid3;

    /**
     * å•†å“æ‰€å±å“ç‰Œid
     */
    private Long brandId;

    /**
     * æ˜¯å¦ä¸Šæ¶ï¼Œ0ä¸‹æ¶ï¼Œ1ä¸Šæ¶
     */
    private Boolean saleable;
    /**
     * å“ç‰Œåç§°
     */
    private String brandName;
    /**
     * åˆ†ç±»åç§°
     * 3çº§åˆ†ç±»åç§°éƒ½è¦
     */
    private String categoryName;

//    å•†å“è¯¦æƒ… spu_detail,spu å’Œ spu_detailè¡¨çš„å…³ç³»
    private SpuDetailDTO spuDetail;
//   skuè¡¨
    private List<SkuDTO> skus;

    @JsonIgnore //å½“åºåˆ—åŒ–jsonçš„æ—¶å€™ï¼Œä¸ä¼šåºåˆ—åŒ–å½“å‰çš„æ–¹æ³•
    public List<Long> getCategoryIds(){
        return Arrays.asList(cid1,cid2,cid3);
    }


}

```

æ¥ä¸‹æ¥å°±å¯ä»¥ç¼–å†™ä¸šåŠ¡äº†

### 3.8.3.ä¸šåŠ¡ä»£ç 

> controller

ä»£ç ï¼š

```java
/**
     * æ–°å¢å•†å“
     * @param spuDTO é¡µé¢æäº¤å•†å“ä¿¡æ¯
     * @return
     */
@PostMapping("/goods")
    public ResponseEntity<Void> saveGoods(@RequestBody SpuDTO spuDTO){
        goodsService.saveGoods(spuDTO);
        return ResponseEntity.status(HttpStatus.CREATED).build();
    }
```

æ³¨æ„ï¼šé€šè¿‡@RequestBodyæ³¨è§£æ¥æ¥æ”¶Jsonè¯·æ±‚

> Service

è¿™é‡Œçš„é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬é™¤äº†è¦å¯¹SPUæ–°å¢ä»¥å¤–ï¼Œè¿˜è¦å¯¹SpuDetailã€Skuã€Stockè¿›è¡Œä¿å­˜

```java
@Transactional(rollbackFor = Exception.class)
    public void saveGoods(SpuDTO spuDTO) {
        //ä¿å­˜spuä¿¡æ¯
        TbSpu tbSpu = BeanHelper.copyProperties(spuDTO, TbSpu.class);
        boolean bSpu = spuService.save(tbSpu);
        if(!bSpu){
            throw  new LyException(ExceptionEnum.INSERT_OPERATION_FAIL);
        }
        Long spuId = tbSpu.getId();
        //è¯¦æƒ…è¡¨
        SpuDetailDTO spuDetailDTO = spuDTO.getSpuDetail();
        TbSpuDetail tbSpuDetail = BeanHelper.copyProperties(spuDetailDTO, TbSpuDetail.class);
        tbSpuDetail.setSpuId(spuId);
        //ä¿å­˜spudetailä¿¡æ¯
        boolean bDetail = detailService.save(tbSpuDetail);
        if(!bDetail){
            throw  new LyException(ExceptionEnum.INSERT_OPERATION_FAIL);
        }
        //ä¿å­˜skuä¿¡æ¯
       List<SkuDTO> skuDTOList = spuDTO.getSkus();
        if(CollectionUtils.isEmpty(skuDTOList)){
            throw new LyException(ExceptionEnum.INVALID_PARAM_ERROR);
        }
        List<TbSku> tbSkuList = BeanHelper.copyWithCollection(skuDTOList, TbSku.class);
        for (TbSku tbSku : tbSkuList) {
            tbSku.setSpuId(spuId);
        }
        boolean b2 = tbSkuService.saveBatch(tbSkuList);
        if(!b2){
            throw new LyException(ExceptionEnum.INSERT_OPERATION_FAIL);
        }

    }
```



# 4.å•†å“ä¸Šä¸‹æ¶

### é‡ç‚¹ï¼šäº†è§£ä¸Šä¸‹æ¶çš„é€»è¾‘å’Œè¦å¤„ç†çš„è¡¨ï¼Œå®Œæˆä»£ç ç¼–å†™ï¼Œæ­£ç¡®å®ç°ä¸šåŠ¡

åœ¨å•†å“è¯¦æƒ…é¡µï¼Œæ¯ä¸€ä¸ªå•†å“åé¢ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªç¼–è¾‘æŒ‰é’®ï¼š

 ![1528874711108](assets/1528874711108.png)

ç‚¹å‡»è¿™ä¸ªæŒ‰é’®ï¼Œå¹¶æ²¡æœ‰æ‰“å¼€å•†å“ç¼–è¾‘çª—å£ï¼Œè€Œæ˜¯å¼¹å‡ºäº†ä¸€ä¸ªæç¤ºçª—å£ï¼š

![1552901853155](assets/1552901853155.png)

å·²ç»ä¸Šæ¶çš„å•†å“ç”¨æˆ·å¯èƒ½æ­£åœ¨è´­ä¹°ï¼Œæ‰€ä»¥ä¸èƒ½ä¿®æ”¹ã€‚å¿…é¡»è¦å…ˆä¸‹æ¶æ‰å¯ä»¥ã€‚

### 4.1.é¡µé¢è¯·æ±‚

æ­¤æ—¶æ‰“å¼€æ§åˆ¶å°ï¼Œå¯ä»¥çœ‹åˆ°è¯·æ±‚å·²ç»å‘å‡ºäº†ï¼š

![1552902179096](assets/1552902179096.png)

è¯·æ±‚æ–¹å¼ï¼šPUT

è¯·æ±‚è·¯å¾„ï¼š/spu/saleable

å‚æ•°æœ‰ä¸¤ä¸ª ï¼š

- idï¼šåº”è¯¥æ˜¯spuçš„id
- saleableï¼šå¸ƒå°”å€¼ï¼Œä»£è¡¨ä¸Šæ¶æˆ–ä¸‹æ¶

è¿”å›ç»“æœï¼šåº”è¯¥æ˜¯æ— 



### 4.2.åå°å®ç°

æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨æœåŠ¡ç«¯æ¥æ”¶è¯·æ±‚ï¼Œå¹¶ä¸”ä¿®æ”¹spuçš„saleableå±æ€§ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨ä¿®æ”¹spuå±æ€§çš„åŒæ—¶ï¼Œè¿˜éœ€è¦ä¿®æ”¹skuçš„enableå±æ€§ï¼Œå› ä¸ºspuä¸‹æ¶ï¼Œskuä¹Ÿè¦è·Ÿç€è¿›è¡Œä¸‹æ¶

controllerï¼š

```java
/**
     * ä¿®æ”¹å•†å“ä¸Šä¸‹æ¶
     * @param id å•†å“spuçš„id
     * @param saleable trueï¼šä¸Šæ¶ï¼›falseï¼šä¸‹æ¶
     * @return
     */
@PutMapping("spu/saleable")
public ResponseEntity<Void> updateSpuSaleable(@RequestParam("id") Long id, @RequestParam("saleable") Boolean saleable) {
    goodsService.updateSaleable(id, saleable);
    return ResponseEntity.status(HttpStatus.NO_CONTENT).build();
}
```



serviceï¼š

```java
@Transactional(rollbackFor = Exception.class)
    public void upateSaleable(Long id, Boolean saleable) {
        //æ›´æ–°spu
        TbSpu tbSpu = new TbSpu();
        tbSpu.setId(id);
        tbSpu.setSaleable(saleable);
        boolean bSpu = spuService.updateById(tbSpu);
        if(!bSpu){
            throw new LyException(ExceptionEnum.UPDATE_OPERATION_FAIL);
        }
        //æ›´æ–°sku
        UpdateWrapper<TbSku> updateWrapper = new UpdateWrapper<>();
        updateWrapper.lambda().eq(TbSku::getSpuId,id);
        updateWrapper.lambda().set(TbSku::getEnable,saleable);
        boolean bSku = skuService.update(updateWrapper);
        if(!bSku){
            throw new LyException(ExceptionEnum.UPDATE_OPERATION_FAIL);
        }
    }
```



# 5.å•†å“æ•°æ®å›æ˜¾

### é‡ç‚¹ï¼šäº†è§£å•†å“å›æ˜¾éœ€è¦çš„æ•°æ®ï¼Œå®Œæˆjavaä»£ç ï¼Œè¿”å›æ­£ç¡®ç»“æœ

### 5.1.ç¼–è¾‘æŒ‰é’®ç‚¹å‡»äº‹ä»¶

ç‚¹å‡»ä¸‹æ¶å•†å“åï¼Œå†æ¬¡ç‚¹å‡»ä¿®æ”¹ï¼Œå‘ç°è¿™æ¬¡æ²¡æœ‰å¼¹å‡ºè­¦å‘Šï¼Œä½†æ˜¯ç¼–è¾‘çª—å£ä¹Ÿæ²¡æœ‰å¼¹å‡ºï¼Œæ€ä¹ˆå›äº‹å‘¢ï¼Ÿ

æ‰“å¼€æ§åˆ¶å°ï¼Œå‘ç°å‘èµ·äº†ä¸€æ¬¡è¯·æ±‚ï¼š

![1552914451933](assets/1552914451933.png)



ç¼–è¾‘æ˜¯éœ€è¦æ•°æ®å›æ˜¾çš„ï¼Œè€Œè¡¨æ ¼æ•°æ®ä¸­åªæœ‰spuä¿¡æ¯ï¼Œæ²¡æœ‰spuDetailå’Œskuä¿¡æ¯ï¼Œéœ€è¦å»æœåŠ¡ç«¯æŸ¥è¯¢ã€‚

å› æ­¤ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±ç¼–å†™åå°æ¥å£ï¼Œæä¾›æŸ¥è¯¢spuDetailå’Œskuæ¥å£ã€‚

### 5.2.æŸ¥è¯¢SpuDetailæ¥å£

> controller

éœ€è¦åˆ†æçš„å†…å®¹ï¼š

- è¯·æ±‚æ–¹å¼ï¼šGET
- è¯·æ±‚è·¯å¾„ï¼š/spu/detail
- è¯·æ±‚å‚æ•°ï¼šidï¼Œåº”è¯¥æ˜¯spuçš„id
- è¿”å›ç»“æœï¼šSpuDetailDTOå¯¹è±¡



```java
/**
     * æ ¹æ®spuIDæŸ¥è¯¢spuDetail
     * @param id spuID
     * @return SpuDetail
     */
@GetMapping("/spu/detail")
public ResponseEntity<SpuDetailDTO> findSpuDetailById(@RequestParam("id") Long id) {
    return ResponseEntity.ok(goodsService.querySpuDetailById(id));
}
```

> service

```java
public SpuDetailDTO findSpuDetail(Long spuId) {
        TbSpuDetail spuDetail = detailService.getById(spuId);
        if(spuDetail == null){
            throw  new LyException(ExceptionEnum.GOODS_DETAIL_NOT_FOUND);
        }
        return BeanHelper.copyProperties(spuDetail,SpuDetailDTO.class);
    }
```

æµ‹è¯•ï¼š

![1552915552485](assets/1552915552485.png)

### 5.3.æŸ¥è¯¢sku

å†æ¬¡ç‚¹å‡»ä¿®æ”¹ï¼Œ å‘ç°åˆå‘å‡ºäº†ä¸€æ¬¡è¯·æ±‚ï¼Œè¿™æ¬¡åº”è¯¥æ˜¯æŸ¥è¯¢skuï¼š

![1552915043070](assets/1552915043070.png)

> åˆ†æ

- è¯·æ±‚æ–¹å¼ï¼šGet
- è¯·æ±‚è·¯å¾„ï¼š/sku/of/spu
- è¯·æ±‚å‚æ•°ï¼šidï¼Œåº”è¯¥æ˜¯spuçš„id
- è¿”å›ç»“æœï¼šskuçš„é›†åˆ

> controller

```java
/**
     * æ ¹æ®spuIDæŸ¥è¯¢sku
     * @param id spuID
     * @return skuçš„é›†åˆ
     */
@GetMapping("/sku/of/spu")
    public ResponseEntity<List<SkuDTO>> findSkuBySpuId(@RequestParam(name="id") Long spuId){
        List<SkuDTO> skuDTOList = goodsService.findSkuListBySpuId(spuId);
        return ResponseEntity.ok(skuDTOList);
    }
```



> service

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸ºäº†é¡µé¢å›æ˜¾æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä¸€å¹¶æŠŠskuä¹ŸæŸ¥è¯¢å‡ºæ¥

```java
public List<SkuDTO> findSkuListBySpuId(Long spuId) {
        QueryWrapper<TbSku> queryWrapper = new QueryWrapper<>();
        queryWrapper.lambda().eq(TbSku::getSpuId,spuId);
        List<TbSku> tbSkuList = skuService.list(queryWrapper);
        if(CollectionUtils.isEmpty(tbSkuList)){
            throw  new LyException(ExceptionEnum.GOODS_NOT_FOUND);
        }
        return BeanHelper.copyWithCollection(tbSkuList,SkuDTO.class);
    }
```

> æµ‹è¯•ï¼š

![1552915617879](assets/1552915617879.png)



### 5.4.é¡µé¢å›æ˜¾

éšä¾¿ç‚¹å‡»ä¸€ä¸ªç¼–è¾‘æŒ‰é’®ï¼Œå‘ç°æ•°æ®å›æ˜¾å®Œæˆï¼š

![1528875639346](assets/1528875639346.png)

![1528875657327](assets/1528875657327.png)





![1528875725545](assets/1528875725545.png)

 ![1528875747067](assets/1528875747067.png)

# 6.å•†å“æ•°æ®ä¿®æ”¹

### é‡ç‚¹ï¼šäº†è§£ä¿®æ”¹å¯¹SKUçš„è¡¨çš„ä¿®æ”¹

è¿™é‡Œçš„ä¿å­˜æŒ‰é’®ä¸æ–°å¢å…¶å®æ˜¯åŒä¸€ä¸ªï¼Œå› æ­¤æäº¤çš„é€»è¾‘ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚

éšä¾¿ä¿®æ”¹ç‚¹æ•°æ®ï¼Œç„¶åç‚¹å‡»ä¿å­˜ï¼Œå¯ä»¥çœ‹åˆ°æµè§ˆå™¨å·²ç»å‘å‡ºè¯·æ±‚ï¼š

![1552916650110](assets/1552916650110.png)

åŒºåˆ«åœ¨äºï¼Œè¿™æ¬¡çš„è¯·æ±‚ä¸­å¸¦ä¸Šäº†idä¿¡æ¯ï¼Œå› ä¸ºéœ€è¦æ ¹æ®idæ¥ä¿®æ”¹æ•°æ®

åŒ…æ‹¬spuDetailä¹Ÿæ˜¯ä¸€æ ·ï¼š

![1552916682788](assets/1552916682788.png)

ä½†æ˜¯å†æ¥çœ‹skuï¼š

![1552916705801](assets/1552916705801.png)

å‘ç°skuä¸­å¹¶æ²¡æœ‰å¸¦ä¸Šskuçš„idä¿¡æ¯ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå¦‚æœæ²¡æœ‰idæˆ‘ä»¬åˆè¯¥æ€æ ·ä¿®æ”¹å‘¢ï¼Ÿ

è¿™æ˜¯å› ä¸ºskuçš„è§„æ ¼å‚æ•°ä¿®æ”¹æˆ–åˆ å‡ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ–°å¢å¾ˆå¤šskuæˆ–è€…ä»¥å‰çš„skuç›´æ¥æ¶ˆå¤±ï¼Œæ— æ³•å»åšä¿®æ”¹æ“ä½œã€‚å› æ­¤å»ºè®®çš„ä¸šåŠ¡é€»è¾‘æ˜¯å…ˆå¯¹skuè¿›è¡Œåˆ é™¤ï¼Œç„¶åå†è¿›è¡Œæ–°å¢ã€‚



## 6.1.åå°å®ç°

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç¼–å†™åå°ï¼Œå®ç°ä¿®æ”¹å•†å“æ¥å£ã€‚

### 6.1.1.Controller

- è¯·æ±‚æ–¹å¼ï¼šPUT
- è¯·æ±‚è·¯å¾„ï¼š/goods
- è¯·æ±‚å‚æ•°ï¼šSpuDTOå¯¹è±¡
- è¿”å›ç»“æœï¼šæ— 

```java
/**
     * ä¿®æ”¹å•†å“
     * @param spu
     * @return
     */
	@PutMapping("/goods")
    public ResponseEntity<Void> updateGoods(@RequestBody SpuDTO spuDTO){
        goodsService.updateGoods(spuDTO);
        return ResponseEntity.status(HttpStatus.NO_CONTENT).build();
    }
```



### 6.2.2.Service

spuæ•°æ®å¯ä»¥ä¿®æ”¹ï¼Œä½†æ˜¯SKUæ•°æ®æ— æ³•ä¿®æ”¹ï¼Œå› ä¸ºæœ‰å¯èƒ½ä¹‹å‰å­˜åœ¨çš„SKUç°åœ¨å·²ç»ä¸å­˜åœ¨äº†ï¼Œæˆ–è€…ä»¥å‰çš„skuå±æ€§éƒ½ä¸å­˜åœ¨äº†ã€‚æ¯”å¦‚ä»¥å‰å†…å­˜æœ‰4Gï¼Œç°åœ¨æ²¡äº†ã€‚

å› æ­¤è¿™é‡Œç›´æ¥åˆ é™¤ä»¥å‰çš„SKUï¼Œç„¶åæ–°å¢å³å¯ã€‚

ä»£ç ï¼š

```java
/**
     * ä¿®æ”¹å•†å“
     * @param spuDTO
     * @return
     */
    @Transactional(rollbackFor = Exception.class)
    public void updateGoods(SpuDTO spuDTO) {
        Long spuId = spuDTO.getId();
//        ä¿®æ”¹spu
        TbSpu tbSpu = BeanHelper.copyProperties(spuDTO, TbSpu.class);
        boolean b = spuService.updateById(tbSpu);
        if(!b){
            throw new LyException(ExceptionEnum.UPDATE_OPERATION_FAIL);
        }
//        ä¿®æ”¹spudetail
        TbSpuDetail tbSpuDetail = BeanHelper.copyProperties(spuDTO.getSpuDetail(), TbSpuDetail.class);
        boolean b1 = spuDetailService.updateById(tbSpuDetail);
        if(!b1){
            throw new LyException(ExceptionEnum.UPDATE_OPERATION_FAIL);
        }
//        åˆ é™¤sku
//        delete from tb_sku where spu_id=?
        QueryWrapper<TbSku> queryWrapper = new QueryWrapper<>();
        queryWrapper.lambda().eq(TbSku::getSpuId,spuId);
        boolean b2 = skuService.remove(queryWrapper);
        if(!b2){
            throw new LyException(ExceptionEnum.DELETE_OPERATION_FAIL);
        }
//        æ–°å¢sku
        List<SkuDTO> skuDTOList = spuDTO.getSkus();
        List<TbSku> tbSkuList = BeanHelper.copyWithCollection(skuDTOList, TbSku.class);
        for (TbSku tbSku : tbSkuList) {
            tbSku.setSpuId(spuId);
        }
//        ä¿å­˜sku
        boolean b3 = skuService.saveBatch(tbSkuList);
        if(!b3){
            throw new LyException(ExceptionEnum.INSERT_OPERATION_FAIL);
        }
    }
```

# ğŸ—ç»éªŒåˆ†äº«-ä¿®æ”¹å•†å“

## 1ã€éœ€æ±‚

> åœ¨å•†å“åˆ—è¡¨ä¸­ï¼Œæ‰¾åˆ°ä¸‹æ¶çš„å•†å“ï¼Œç‚¹å‡»ç¼–è¾‘ï¼Œæ¥ä¿®æ”¹å•†å“ä¿¡æ¯

æ“ä½œç•Œé¢ï¼š

![](../../../%E8%AF%BE%E7%A8%8B/%E9%A1%B9%E7%9B%AE%E4%BA%8C/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E-%E6%89%80%E6%9C%89%E7%AC%94%E8%AE%B0-%E5%B8%A6%E7%BB%8F%E9%AA%8C%E5%80%BC/assets/1594127604.png)

## 2ã€æŠ¥é”™ä¿¡æ¯

> ç‚¹å‡»ç¼–è¾‘åï¼Œå‘ç°å¹¶æ²¡æœ‰æ˜¾ç¤ºå•†å“ç¼–è¾‘é¡µé¢ï¼Œæˆ‘ä»¬æ‰“å¼€Chromeæµè§ˆå™¨çš„å¼€å‘å·¥å…·ï¼Œå‘ç°æœ‰æŠ¥é”™ï¼Œç‚¹å‡»Networkåä¿¡æ¯å¦‚ä¸‹ï¼š
>
> åœ¨è¯·æ±‚http://api.leyou.com/api/item/spu/detail?id=2 æ—¶å‡ºç°é”™è¯¯ï¼Œè¿™ä¸ªè¯·æ±‚ç”¨spuidæ¥æŸ¥è¯¢spuDetailï¼ˆå•†å“è¯¦æƒ…ï¼‰çš„æ•°æ®ã€‚

![](../../../%E8%AF%BE%E7%A8%8B/%E9%A1%B9%E7%9B%AE%E4%BA%8C/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E-%E6%89%80%E6%9C%89%E7%AC%94%E8%AE%B0-%E5%B8%A6%E7%BB%8F%E9%AA%8C%E5%80%BC/assets/1594127956.png)

> ç„¶åç‚¹å‡» Previewï¼Œå¯ä»¥çœ‹åˆ°å…·ä½“æŠ¥é”™ï¼Œæç¤ºå•†å“ä¸å­˜åœ¨ï¼Œå¯ä»¥æˆ‘ä»¬åœ¨å•†å“åˆ—è¡¨ä¸­æ˜¯å¯ä»¥çœ‹åˆ°è¿™ä¸ªå•†å“çš„ã€‚

![](../../../%E8%AF%BE%E7%A8%8B/%E9%A1%B9%E7%9B%AE%E4%BA%8C/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E-%E6%89%80%E6%9C%89%E7%AC%94%E8%AE%B0-%E5%B8%A6%E7%BB%8F%E9%AA%8C%E5%80%BC/assets/1594128074.png)

## 3ã€é—®é¢˜åˆ†æ

> åˆ†æï¼š
>
> ä»å®¢æˆ·ç«¯å‘å‡ºçš„è¯·æ±‚æ¥çœ‹ï¼Œå¹¶ä¸èƒ½çœ‹å‡ºä»€ä¹ˆé”™è¯¯ã€‚è¿™æ—¶å°±éœ€è¦åˆ°æœåŠ¡ç«¯æ‰¾åˆ°å¯¹åº”çš„å¾®æœåŠ¡ï¼ŒæŸ¥çœ‹å¾®æœåŠ¡çš„è¾“å‡ºæ—¥å¿—ï¼Œæ¥æ‰¾é—®é¢˜ã€‚

å»itemæœåŠ¡æŸ¥çœ‹æ—¥å¿—

> åœ¨itemæœåŠ¡çš„æ—¥å¿—ä¸­æˆ‘ä»¬å‘ç°æœ‰è¿™æ ·çš„é”™è¯¯ä¿¡æ¯ï¼Œå¦‚å›¾:

![](../../../%E8%AF%BE%E7%A8%8B/%E9%A1%B9%E7%9B%AE%E4%BA%8C/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E-%E6%89%80%E6%9C%89%E7%AC%94%E8%AE%B0-%E5%B8%A6%E7%BB%8F%E9%AA%8C%E5%80%BC/assets/1594127392-1594128652657.png)

> åœ¨è¿™ä¸ªé”™è¯¯ä¿¡æ¯ä¸­ï¼Œå¯ä»¥å‘ç° Where null = 2  è¿™æ ·çš„è¯­å¥ã€‚ è¿™ä¸ªSQLæ˜¯ä½¿ç”¨spuidæŸ¥è¯¢tb_spu_detailçš„æ•°æ®ï¼Œtb_spuè¡¨å’Œtb_spu_detailè¡¨æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œä¹Ÿå°±æ˜¯spu_idä¹Ÿæ˜¯spu_detailçš„ä¸»é”®ã€‚
>
> é‚£ä¹ˆåœ¨whereè¯­å¥ä¸­ï¼Œåº”è¯¥å‡ºç°spu_idè¿™ä¸ªå­—æ®µçš„åå­—ï¼Œå¯æ˜¯è¿™é‡Œå´ æ˜¯nullã€‚
>
> é”™è¯¯æ­£å¼å› ä¸ºè¿™ä¸ªé”™è¯¯çš„whereæ¡ä»¶å¼•èµ·çš„ã€‚å½“å‰æˆ‘ä»¬ä½¿ç”¨MybaitsPlusï¼Œè¿™ä¸ªSQLæ˜¯ç”±MybaitsPlusè‡ªåŠ¨ä¸ºæˆ‘ä»¬ç”Ÿæˆçš„ï¼Œéš¾é“æ˜¯MybaitsPluså‡ºé”™äº†ï¼Ÿ

## 4ã€å¯»æ‰¾çœŸæ­£çš„é”™è¯¯

> å½“å‰æˆ‘ä»¬ä½¿ç”¨çš„æŒä¹…å±‚æ¡†æ¶æ˜¯MybaitsPlusï¼Œåœ¨MybaitsPlusçš„æ³¨è§£ä¸­æœ‰ä¸€ä¸ªåœ¨å®ä½“ç±»ä¸­å¯ä»¥æ ‡è¯†ä¸»é”®çš„æ³¨è§£
>
> @TableIdã€‚
>
> æˆ‘ä»¬æŸ¥çœ‹tb_spu_detailè¡¨å¯¹åº”çš„å®ä½“ç±»TbSpuDetailï¼Œå‘ç°åœ¨spuIdä¸Šå¹¶æ²¡æœ‰@TableIdæ³¨è§£ã€‚MybaitsPlusçš„ç”Ÿæˆå™¨åœ¨ç”Ÿæˆå®ä½“ç±»æ—¶ï¼Œå¦‚æœä¸»é”®çš„ç”Ÿæˆç­–ç•¥ä¸æ˜¯è‡ªå¢ï¼ˆAUTO_INCREMENTï¼‰è€Œæ˜¯éœ€è¦ç”¨æˆ·è¾“å…¥ï¼Œé‚£ä¹ˆåœ¨ç”Ÿæˆå®ä½“ç±»çš„æ—¶å€™ï¼Œå°±ä¸ä¼šç»™è¿™ä¸ªä¸»é”®å¯¹åº”çš„å±æ€§æ·»åŠ @TableIdæ³¨è§£ã€‚
>
> ç”±äºTbSpuDetailç±»ç¼ºå°‘@TableIdæ³¨è§£ï¼Œå¯¼è‡´åœ¨ä½¿ç”¨spuIdæŸ¥è¯¢spuDetailæ•°æ®çš„æ—¶å€™ä¸çŸ¥é“å“ªä¸ªå±æ€§æ˜¯æ³¨è§£ã€‚SQLè¯­å¥çš„whereæ¡ä»¶ å‡ºç°  null = 2

![](../../../%E8%AF%BE%E7%A8%8B/%E9%A1%B9%E7%9B%AE%E4%BA%8C/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E-%E6%89%80%E6%9C%89%E7%AC%94%E8%AE%B0-%E5%B8%A6%E7%BB%8F%E9%AA%8C%E5%80%BC/assets/1594129885.png)

## 5ã€è§£å†³é”™è¯¯

> ç°åœ¨ç»™spuIdè¿™ä¸ªå±æ€§æ·»åŠ @TableIdæ³¨è§£ï¼Œæ ‡è¯†è¿™ä¸ªå±æ€§å¯¹åº”çš„ä¸»é”®åå­—ã€‚

ä»£ç ï¼š

```java
@TableId(value = "spu_id",type = IdType.INPUT)
```

å±æ€§è§£é‡Šï¼š

> valueï¼šå½“å‰å±æ€§å¯¹åº”çš„å­—æ®µåå­—
>
> typeï¼šå½“å‰ä¸»é”®çš„ç”Ÿæˆç­–ç•¥ã€‚   IdType.INPUT -- ä»£è¡¨ç”¨æˆ·è¾“å…¥

## 6ã€éªŒè¯

> åŠ ä¸Šæ³¨è§£åï¼Œé‡å¯itemæœåŠ¡éªŒè¯ï¼Œé¡µé¢ä¸Šç‚¹å‡»ç¼–è¾‘æŒ‰é’®ï¼Œå‘ç°è¯·æ±‚å¯ä»¥æ­£å¸¸è¿”å›æ•°æ®ï¼Œç¼–è¾‘çª—å£ä¹Ÿæ˜¾ç¤ºå‡ºæ¥ï¼Œå¦‚å›¾ï¼š

![](../../../%E8%AF%BE%E7%A8%8B/%E9%A1%B9%E7%9B%AE%E4%BA%8C/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E-%E6%89%80%E6%9C%89%E7%AC%94%E8%AE%B0-%E5%B8%A6%E7%BB%8F%E9%AA%8C%E5%80%BC/assets/1594132653.png)





# 7.æ­å»ºå‰å°ç³»ç»Ÿ

## é‡ç‚¹ï¼šèƒ½å¤Ÿå®Œæˆå‰å°ç³»ç»Ÿçš„æ­å»ºï¼Œå¹¶è¿è¡Œçœ‹åˆ°é¡µé¢æ•ˆæœ

åå°ç³»ç»Ÿçš„å†…å®¹æš‚æ—¶å‘Šä¸€æ®µè½ï¼Œæœ‰äº†å•†å“ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦åœ¨é¡µé¢å±•ç¤ºå•†å“ï¼Œç»™ç”¨æˆ·æä¾›æµè§ˆå’Œè´­ä¹°çš„å…¥å£ï¼Œé‚£å°±æ˜¯æˆ‘ä»¬çš„é—¨æˆ·ç³»ç»Ÿã€‚

é—¨æˆ·ç³»ç»Ÿé¢å‘çš„æ˜¯ç”¨æˆ·ï¼Œå®‰å…¨æ€§å¾ˆé‡è¦ï¼Œè€Œä¸”æœç´¢å¼•æ“å¯¹äºå•é¡µåº”ç”¨å¹¶ä¸å‹å¥½ã€‚å› æ­¤æˆ‘ä»¬çš„é—¨æˆ·ç³»ç»Ÿä¸å†é‡‡ç”¨ä¸åå°ç³»ç»Ÿç±»ä¼¼çš„SPAï¼ˆå•é¡µåº”ç”¨ï¼‰ã€‚

ä¾ç„¶æ˜¯å‰åç«¯åˆ†ç¦»ï¼Œä¸è¿‡å‰ç«¯çš„é¡µé¢ä¼šä½¿ç”¨ç‹¬ç«‹çš„htmlï¼Œåœ¨æ¯ä¸ªé¡µé¢ä¸­ä½¿ç”¨vueæ¥åšé¡µé¢æ¸²æŸ“ã€‚



## 7.1.é™æ€èµ„æº

webpackæ‰“åŒ…å¤šé¡µåº”ç”¨é…ç½®æ¯”è¾ƒç¹çï¼Œé¡¹ç›®ç»“æ„ä¹Ÿç›¸å¯¹å¤æ‚ã€‚è¿™é‡Œä¸ºäº†ç®€åŒ–å¼€å‘ï¼ˆæ¯•ç«Ÿæˆ‘ä»¬ä¸æ˜¯ä¸“ä¸šçš„å‰ç«¯äººå‘˜ï¼‰ï¼Œæˆ‘ä»¬ä¸åœ¨ä½¿ç”¨webpackï¼Œè€Œæ˜¯ç›´æ¥ç¼–å†™åŸç”Ÿçš„é™æ€HTMLã€‚

### 7.1.1.å¯¼å…¥é™æ€èµ„æº

å°†è¯¾å‰èµ„æ–™ä¸­çš„leyou-portalè§£å‹ï¼Œå¹¶æŠŠç»“æœèµ‹å€¼åˆ°å·¥ä½œç©ºé—´çš„ç›®å½•

 ![1526460560069](assets/1526460560069.png)

è§£å‹ç¼©ï¼š

 ![1526460681615](assets/1526460681615.png)

ç„¶åé€šè¿‡ideaæ‰“å¼€ï¼Œå¯ä»¥çœ‹åˆ°é¡¹ç›®ç»“æ„ï¼š

 ![1526460701617](assets/1526460701617.png)



## 7.2.æ·»åŠ å¯åŠ¨è„šæœ¬

åˆå§‹åŒ–npm

```
npm init -y
```

å®‰è£…vue

```
npm install vue --save
```

é…ç½®å¯åŠ¨è„šæœ¬ï¼š

è¿›å…¥package.jsonæ–‡ä»¶ï¼Œåœ¨scriptä¸­æ·»åŠ å¯åŠ¨è„šæœ¬ï¼š

```json
{
  "name": "leyou-portal",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "serve": "live-server --port=9002"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "dependencies": {
    "vue": "^2.6.10"
  }
}
```

ä»¥åå¯ä»¥ç”¨ npm run serveå¯åŠ¨

## 7.3.live-server

æ²¡æœ‰webpackï¼Œæˆ‘ä»¬å°±æ— æ³•ä½¿ç”¨webpack-dev-serverè¿è¡Œè¿™ä¸ªé¡¹ç›®ï¼Œå®ç°çƒ­éƒ¨ç½²ã€‚

æ‰€ä»¥ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨å¦å¤–ä¸€ç§çƒ­éƒ¨ç½²æ–¹å¼ï¼šlive-serverï¼Œ

### 7.3.1.ç®€ä»‹

åœ°å€ï¼›https://www.npmjs.com/package/live-server

 ![1526460917348](assets/1526460917348.png)

è¿™æ˜¯ä¸€æ¬¾å¸¦æœ‰çƒ­åŠ è½½åŠŸèƒ½çš„å°å‹å¼€å‘æœåŠ¡å™¨ã€‚ç”¨å®ƒæ¥å±•ç¤ºä½ çš„HTML / JavaScript / CSSï¼Œä½†ä¸èƒ½ç”¨äºéƒ¨ç½²æœ€ç»ˆçš„ç½‘ç«™ã€‚ 

### 7.3.2.å®‰è£…

å®‰è£…live-serverï¼Œè¿™é‡Œå»ºè®®å…¨å±€å®‰è£…ï¼Œä»¥åä»»æ„ä½ç½®å¯ç”¨

```
npm install -g live-server
```



è¿è¡Œæ—¶ï¼Œç›´æ¥è¾“å…¥å‘½ä»¤ï¼š

```
live-server
```

å¦å¤–ï¼Œä½ å¯ä»¥åœ¨è¿è¡Œå‘½ä»¤åï¼Œè·Ÿä¸Šä¸€äº›å‚æ•°ä»¥é…ç½®ï¼š

- `--port=NUMBER` - é€‰æ‹©è¦ä½¿ç”¨çš„ç«¯å£ï¼Œé»˜è®¤å€¼ï¼šPORT env varæˆ–8080
- `--host=ADDRESS` - é€‰æ‹©è¦ç»‘å®šçš„ä¸»æœºåœ°å€ï¼Œé»˜è®¤å€¼ï¼šIP env varæˆ–0.0.0.0ï¼ˆâ€œä»»æ„åœ°å€â€ï¼‰
- `--no-browser` - ç¦æ­¢è‡ªåŠ¨Webæµè§ˆå™¨å¯åŠ¨
- `--browser=BROWSER` - æŒ‡å®šä½¿ç”¨æµè§ˆå™¨è€Œä¸æ˜¯ç³»ç»Ÿé»˜è®¤å€¼
- `--quiet | -q` - ç¦æ­¢è®°å½•
- `--verbose | -V` - æ›´å¤šæ—¥å¿—è®°å½•ï¼ˆè®°å½•æ‰€æœ‰è¯·æ±‚ï¼Œæ˜¾ç¤ºæ‰€æœ‰ä¾¦å¬çš„IPv4æ¥å£ç­‰ï¼‰
- `--open=PATH` - å¯åŠ¨æµè§ˆå™¨åˆ°PATHè€Œä¸æ˜¯æœåŠ¡å™¨root
- `--watch=PATH` - ç”¨é€—å·åˆ†éš”çš„è·¯å¾„æ¥ä¸“é—¨ç›‘è§†å˜åŒ–ï¼ˆé»˜è®¤å€¼ï¼šè§‚çœ‹æ‰€æœ‰å†…å®¹ï¼‰
- `--ignore=PATH`- è¦å¿½ç•¥çš„é€—å·åˆ†éš”çš„è·¯å¾„å­—ç¬¦ä¸²ï¼ˆ[anymatch](https://github.com/es128/anymatch) -compatible definitionï¼‰
- `--ignorePattern=RGXP`-æ–‡ä»¶çš„æ­£åˆ™è¡¨è¾¾å¼å¿½ç•¥ï¼ˆå³`.*\.jade`ï¼‰ï¼ˆ**ä¸æ¨èä½¿ç”¨**èµæˆ`--ignore`ï¼‰
- `--middleware=PATH` - å¯¼å‡ºè¦æ·»åŠ çš„ä¸­é—´ä»¶åŠŸèƒ½çš„.jsæ–‡ä»¶çš„è·¯å¾„; å¯ä»¥æ˜¯æ²¡æœ‰è·¯å¾„çš„åç§°ï¼Œä¹Ÿå¯ä»¥æ˜¯å¼•ç”¨`middleware`æ–‡ä»¶å¤¹ä¸­æ†ç»‘çš„ä¸­é—´ä»¶çš„æ‰©å±•å
- `--entry-file=PATH` - æä¾›æ­¤æ–‡ä»¶ï¼ˆæœåŠ¡å™¨æ ¹ç›®å½•ï¼‰ä»£æ›¿ä¸¢å¤±çš„æ–‡ä»¶ï¼ˆå¯¹å•é¡µåº”ç”¨ç¨‹åºæœ‰ç”¨ï¼‰
- `--mount=ROUTE:PATH` - åœ¨å®šä¹‰çš„è·¯çº¿ä¸‹æä¾›è·¯å¾„å†…å®¹ï¼ˆå¯èƒ½æœ‰å¤šä¸ªå®šä¹‰ï¼‰
- `--spa` - å°†è¯·æ±‚ä»/ abcè½¬æ¢ä¸º/ï¼ƒ/ abcï¼ˆæ–¹ä¾¿å•é¡µåº”ç”¨ï¼‰
- `--wait=MILLISECONDS` - ï¼ˆé»˜è®¤100msï¼‰ç­‰å¾…æ‰€æœ‰æ›´æ”¹ï¼Œç„¶åé‡æ–°åŠ è½½
- `--htpasswd=PATH` - å¯ç”¨æœŸå¾…ä½äºPATHçš„htpasswdæ–‡ä»¶çš„http-auth
- `--cors` - ä¸ºä»»ä½•æ¥æºå¯ç”¨CORSï¼ˆåæ˜ è¯·æ±‚æºï¼Œæ”¯æŒå‡­è¯çš„è¯·æ±‚ï¼‰
- `--https=PATH` - åˆ°HTTPSé…ç½®æ¨¡å—çš„è·¯å¾„
- `--proxy=ROUTE:URL` - ä»£ç†ROUTEåˆ°URLçš„æ‰€æœ‰è¯·æ±‚
- `--help | -h` - æ˜¾ç¤ºç®€æ´çš„ä½¿ç”¨æç¤ºå¹¶é€€å‡º
- `--version | -v` - æ˜¾ç¤ºç‰ˆæœ¬å¹¶é€€å‡º

### 7.3.3.æµ‹è¯•

æˆ‘ä»¬è¿›å…¥leyou-portalç›®å½•ï¼Œè¾“å…¥å‘½ä»¤ï¼š

```
live-server --port=9002
```

 ![1526462494331](assets/1526462494331.png)



## 7.4.åŸŸåè®¿é—®

ç°åœ¨æˆ‘ä»¬è®¿é—®åªèƒ½é€šè¿‡ï¼šhttp://127.0.0.1:9002

æˆ‘ä»¬å¸Œæœ›ç”¨åŸŸåè®¿é—®ï¼šhttp://www.leyou.com

ç¬¬ä¸€æ­¥ï¼Œä¿®æ”¹hostsæ–‡ä»¶ï¼Œæ·»åŠ ä¸€è¡Œé…ç½®ï¼š

```
127.0.0.1 www.leyou.com
```

ç¬¬äºŒæ­¥ï¼Œä¿®æ”¹nginxé…ç½®ï¼Œå°†www.leyou.comåå‘ä»£ç†åˆ°127.0.0.1:9002

```nginx
server {
    listen       80;
    server_name  www.leyou.com;

    proxy_set_header X-Forwarded-Host $host;
    proxy_set_header X-Forwarded-Server $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

    location / {
        proxy_pass http://127.0.0.1:9002;
        proxy_connect_timeout 600;
        proxy_read_timeout 600;
    }
}
```

é‡æ–°åŠ è½½nginxé…ç½®ï¼š`nginx.exe -s reload`

![1526462774092](assets/1526462774092.png)





## 7.5.common.js

ä¸ºäº†æ–¹ä¾¿åç»­çš„å¼€å‘ï¼Œæˆ‘ä»¬åœ¨å‰å°ç³»ç»Ÿä¸­å®šä¹‰äº†ä¸€äº›å·¥å…·ï¼Œæ”¾åœ¨äº†common.jsä¸­ï¼š

 ![1526643361038](assets/1526643361038.png)



éƒ¨åˆ†ä»£ç æˆªå›¾ï¼š

 ![1526643526973](assets/1526643526973.png)

- é¦–å…ˆå¯¹axiosè¿›è¡Œäº†ä¸€äº›å…¨å±€é…ç½®ï¼Œè¯·æ±‚è¶…æ—¶æ—¶é—´ï¼Œè¯·æ±‚çš„åŸºç¡€è·¯å¾„ï¼Œæ˜¯å¦å…è®¸è·¨åŸŸæ“ä½œcookieç­‰
- å®šä¹‰äº†å¯¹è±¡ ly ï¼Œä¹Ÿå«leyouï¼ŒåŒ…å«äº†ä¸‹é¢çš„å±æ€§ï¼š
  - getUrlParam(key)ï¼šè·å–urlè·¯å¾„ä¸­çš„å‚æ•°
  - httpï¼šaxioså¯¹è±¡çš„åˆ«åã€‚ä»¥åå‘èµ·ajaxè¯·æ±‚ï¼Œå¯ä»¥ç”¨ly.http.get()
  - storeï¼šlocalstorageä¾¿æ·æ“ä½œï¼Œåé¢ç”¨åˆ°å†è¯¦ç»†è¯´æ˜
  - formatPriceï¼šæ ¼å¼åŒ–ä»·æ ¼ï¼Œå¦‚æœä¼ å…¥çš„æ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™æ‰©å¤§100è¢«å¹¶è½¬ä¸ºæ•°å­—ï¼Œå¦‚æœä¼ å…¥æ˜¯æ•°å­—ï¼Œåˆ™ç¼©å°100å€å¹¶è½¬ä¸ºå­—ç¬¦ä¸²
  - formatDate(val, pattern)ï¼šå¯¹æ—¥æœŸå¯¹è±¡valæŒ‰ç…§æŒ‡å®šçš„patternæ¨¡æ¿è¿›è¡Œæ ¼å¼åŒ–
  - stringifyï¼šå°†å¯¹è±¡è½¬ä¸ºå‚æ•°å­—ç¬¦ä¸²
  - parseï¼šå°†å‚æ•°å­—ç¬¦ä¸²å˜ä¸ºjså¯¹è±¡



